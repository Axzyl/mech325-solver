<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helical Gear Design Calculator (Fizz)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .pdf-column {
            flex: 1;
            background: #2c3e50;
            padding: 20px;
            overflow-y: auto;
            max-height: 95vh;
        }
        .pdf-container {
            position: relative;
            width: 100%;
            height: 100%;
            flex: 1;
            display: flex;
        }
        .pdf-column embed {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* PDF Crosshairs Feature */
        .click-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            cursor: crosshair;
        }
        .crosshairs-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        .crosshair-line {
            stroke: #ff0000;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .crosshair-line.active {
            opacity: 0.8;
        }
        .calculator-column {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            max-height: 95vh;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }
        h2 {
            color: #3498db;
            margin: 20px 0 10px;
            font-size: 1.1em;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .section-divider {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        .equation-block {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .equation-latex {
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            text-align: center;
        }
        .equation-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .var-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .var-input label {
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }
        .var-input input {
            width: 100px;
            padding: 8px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
            text-align: center;
        }
        .var-input input:focus {
            outline: none;
            border-color: #3498db;
        }
        .var-input input.computed {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .equation-inputs > span {
            font-size: 1.2em;
            font-weight: bold;
            color: #666;
            margin: 0 5px;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .input-row label {
            min-width: 250px;
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }
        .input-row input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9em;
        }
        .input-row input:focus {
            outline: none;
            border-color: #3498db;
        }
        .input-row input.computed {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .note {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #2196f3;
            margin: 10px 0;
            font-size: 0.9em;
        }
        .note a {
            color: #0066cc;
            text-decoration: underline;
            font-weight: 600;
            cursor: pointer;
        }
        .note a:hover {
            color: #004499;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Button Group */
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 100;
            padding: 15px 0;
            margin-top: -15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .save-btn {
            background: #28a745;
            color: white;
            flex: 1;
        }
        .save-btn:hover {
            background: #218838;
        }
        .reset-btn {
            background: #dc3545;
            color: white;
            flex: 1;
        }
        .reset-btn:hover {
            background: #c82333;
        }
        .toggle-crosshairs-btn {
            background: #6c757d;
            color: white;
            flex: 1;
        }
        .toggle-crosshairs-btn:hover {
            background: #5a6268;
        }
        .toggle-crosshairs-btn.active {
            background: #28a745;
        }
        .toggle-crosshairs-btn.active:hover {
            background: #218838;
        }

        /* Tab System */
        .tabs {
            display: flex;
            border-bottom: 2px solid #3498db;
            margin-bottom: 20px;
            gap: 5px;
        }
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #7f8c8d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            font-weight: 600;
        }
        .tab-button:hover {
            color: #3498db;
            background: #f8f9fa;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Variables Table */
        .variables-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .variables-table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .variables-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        .variables-table tbody tr:hover {
            background: #f8f9fa;
        }
        .var-category {
            background: #e3f2fd;
            font-weight: 600;
            color: #1976d2;
        }
        .variables-table input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pdf-column">
            <div class="pdf-container">
                <embed src="../../documents/gears/fizz_helical.pdf" type="application/pdf" id="pdf">
                <div class="click-overlay" id="click-overlay"></div>
                <svg id="pdf-crosshairs" class="crosshairs-overlay">
                    <line id="crosshair-vertical" class="crosshair-line" x1="0" y1="0" x2="0" y2="100%" />
                    <line id="crosshair-horizontal" class="crosshair-line" x1="0" y1="0" x2="100%" y2="0" />
                </svg>
            </div>
        </div>
        <div class="calculator-column">
            <h1>Helical Gear Design Calculator</h1>

            <!-- Button Group -->
            <div class="button-group">
                <button class="save-btn" onclick="saveSessionManual()">ðŸ’¾ Save Session</button>
                <button class="reset-btn" onclick="resetAll()">ðŸ”„ Reset All</button>
                <button class="toggle-crosshairs-btn" id="toggle-crosshairs-btn" onclick="toggleCrosshairsFeature()">ðŸŽ¯ Enable Crosshairs</button>
            </div>

            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('procedure')">Procedure</button>
                <button class="tab-button" onclick="showTab('equations')">General Equations</button>
                <button class="tab-button" onclick="showTab('variables')">Variables</button>
            </div>

            <!-- Procedure Tab -->
            <div id="procedure-tab" class="tab-content active">

            <!-- HELICAL-SPECIFIC STEPS 1-13 -->
            <div class="section">
                <h2>Given Information (Helical)</h2>
                <div class="input-row">
                    <label>P - Power (hp):</label>
                    <input type="number" id="P" step="any" oninput="markAsUser('P'); calculate()">
                </div>
                <div class="input-row">
                    <label>K<sub>O</sub> - Shock Factor:</label>
                    <input type="number" id="KO" step="any" oninput="markAsUser('KO'); calculate()">
                </div>
                <div class="note">ðŸ“Š Look up K<sub>O</sub> from <a href="#" onclick="goToPage(1)">Table 8-1</a> in PDF based on load type</div>
                <div class="input-row">
                    <label>n<sub>P</sub> - Pinion Speed (rpm):</label>
                    <input type="number" id="nP" step="any" oninput="markAsUser('nP'); calculate()">
                </div>
                <div class="input-row">
                    <label>N<sub>P</sub> - Number of Teeth on Pinion:</label>
                    <input type="number" id="NP" step="1" oninput="markAsUser('NP'); calculate()">
                </div>
                <div class="input-row">
                    <label>N<sub>G</sub> - Number of Teeth on Gear:</label>
                    <input type="number" id="NG" step="1" oninput="markAsUser('NG'); calculate()">
                </div>
                <div class="input-row">
                    <label>Ïˆ - Helix Angle (deg):</label>
                    <input type="number" id="psi" step="any" oninput="markAsUser('psi'); calculate()">
                </div>
                <div class="input-row">
                    <label>P<sub>nd</sub> - Normal Diametral Pitch:</label>
                    <input type="number" id="Pnd" step="any" oninput="markAsUser('Pnd'); calculate()">
                </div>
                <div class="note">ðŸ“Š Choose standard P<sub>nd</sub> from <a href="#" onclick="goToPage(2)">Table 8-2</a> in PDF</div>
                <div class="input-row">
                    <label>F - Face Width (in):</label>
                    <input type="number" id="F" step="any" oninput="markAsUser('F'); calculate()">
                </div>
            </div>

            <div class="section">
                <h2>Step 3: Transverse Diametral Pitch</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$P_d = P_{nd} \cos(\psi)$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>P<sub>d</sub> =</label>
                            <input type="number" id="Pd" step="any" oninput="markAsUser('Pd'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>P<sub>nd</sub></label>
                            <input type="number" id="Pnd_eq3" step="any" oninput="syncInput('Pnd', 'Pnd_eq3')">
                        </div>
                        <span>Ã— cos(</span>
                        <div class="var-input">
                            <label>Ïˆ</label>
                            <input type="number" id="psi_eq3" step="any" oninput="syncInput('psi', 'psi_eq3')">
                        </div>
                        <span>)</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 4-6: Gear Geometry</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$D_P = \frac{N_P}{P_d}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>D<sub>P</sub> (in) =</label>
                            <input type="number" id="DP" step="any" oninput="markAsUser('DP'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>N<sub>P</sub></label>
                            <input type="number" id="NP_eq4" step="1" oninput="syncInput('NP', 'NP_eq4')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_eq4" step="any" oninput="syncInput('Pd', 'Pd_eq4')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$D_G = \frac{N_G}{P_d}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>D<sub>G</sub> (in) =</label>
                            <input type="number" id="DG" step="any" oninput="markAsUser('DG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_eq5" step="1" oninput="syncInput('NG', 'NG_eq5')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_eq5" step="any" oninput="syncInput('Pd', 'Pd_eq5')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$C = \frac{D_P + D_G}{2}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>C (in) =</label>
                            <input type="number" id="C" step="any" oninput="markAsUser('C'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(</span>
                        <div class="var-input">
                            <label>D<sub>P</sub></label>
                            <input type="number" id="DP_eq6" step="any" oninput="syncInput('DP', 'DP_eq6')">
                        </div>
                        <span>+</span>
                        <div class="var-input">
                            <label>D<sub>G</sub></label>
                            <input type="number" id="DG_eq6" step="any" oninput="syncInput('DG', 'DG_eq6')">
                        </div>
                        <span>) / 2</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 7: Velocity</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$V_t = \frac{\pi D_P n_P}{12}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>V<sub>t</sub> (ft/min) =</label>
                            <input type="number" id="Vt" step="any" oninput="markAsUser('Vt'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(Ï€ Ã—</span>
                        <div class="var-input">
                            <label>D<sub>P</sub></label>
                            <input type="number" id="DP_eq7" step="any" oninput="syncInput('DP', 'DP_eq7')">
                        </div>
                        <span>Ã—</span>
                        <div class="var-input">
                            <label>n<sub>P</sub></label>
                            <input type="number" id="nP_eq7" step="any" oninput="syncInput('nP', 'nP_eq7')">
                        </div>
                        <span>) / 12</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 8-10: Quality and Dynamic Factor</h2>
                <div class="input-row">
                    <label>Q<sub>v</sub> - Quality Number:</label>
                    <input type="number" id="Qv" step="1" oninput="markAsUser('Qv'); calculate()">
                </div>
                <div class="note">ðŸ“Š Choose Q<sub>v</sub> from <a href="#" onclick="goToPage(3)">Table 8-3</a> based on velocity</div>
                <div class="input-row">
                    <label>K<sub>v</sub> - Dynamic Factor:</label>
                    <input type="number" id="Kv" step="any" oninput="markAsUser('Kv'); calculate()">
                </div>
                <div class="note">ðŸ“Š Calculate from K<sub>v</sub> = [(A + âˆšV<sub>t</sub>)/A]<sup>B</sup> using <a href="#" onclick="goToPage(4)">Table 8-4</a></div>
            </div>

            <div class="section">
                <h2>Step 11-12: Pressure Angles</h2>
                <div class="input-row">
                    <label>Ï†<sub>n</sub> - Normal Pressure Angle (deg):</label>
                    <input type="number" id="phi_n" step="any" value="20" oninput="markAsUser('phi_n'); calculate()">
                </div>
                <div class="note">Typically 20Â° for helical gears</div>

                <div class="equation-block">
                    <div class="equation-latex">$$\phi_t = \arctan\left(\frac{\tan(\phi_n)}{\cos(\psi)}\right)$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ï†<sub>t</sub> (deg) =</label>
                            <input type="number" id="phi_t" step="any" oninput="markAsUser('phi_t'); calculate()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 13: Geometry Factors</h2>
                <div class="input-row">
                    <label>J<sub>P</sub> - Bending Factor (Pinion):</label>
                    <input type="number" id="JP" step="any" oninput="markAsUser('JP'); calculate()">
                </div>
                <div class="input-row">
                    <label>J<sub>G</sub> - Bending Factor (Gear):</label>
                    <input type="number" id="JG" step="any" oninput="markAsUser('JG'); calculate()">
                </div>
                <div class="input-row">
                    <label>I - Contact Geometry Factor:</label>
                    <input type="number" id="I" step="any" oninput="markAsUser('I'); calculate()">
                </div>
                <div class="note">ðŸ“Š Look up from <a href="#" onclick="goToPage(5)">Figures 8-16 to 8-18</a> based on N<sub>P</sub>, N<sub>G</sub>, and Ï†<sub>t</sub></div>
            </div>

            <!-- TRANSITION TO SPUR GUIDE -->
            <div class="section-divider">
                â¬‡ Continue with Spur Guide Steps 32-40 â¬‡
            </div>

            <div class="section">
                <h2>Spur Step 32-34: Life Factors</h2>
                <div class="input-row">
                    <label>N<sub>c</sub> - Design Life Cycles:</label>
                    <input type="number" id="Nc" step="any" oninput="markAsUser('Nc'); calculate()">
                </div>
                <div class="input-row">
                    <label>Y<sub>N</sub> - Stress Cycle Factor (Bending):</label>
                    <input type="number" id="YN" step="any" oninput="markAsUser('YN'); calculate()">
                </div>
                <div class="note">ðŸ“Š Look up from <a href="#" onclick="goToPage(6)">Figure 8-14</a> in spur PDF</div>
                <div class="input-row">
                    <label>Z<sub>N</sub> - Stress Cycle Factor (Contact):</label>
                    <input type="number" id="ZN" step="any" oninput="markAsUser('ZN'); calculate()">
                </div>
                <div class="note">ðŸ“Š Look up from <a href="#" onclick="goToPage(7)">Figure 8-15</a> in spur PDF</div>
                <div class="input-row">
                    <label>K<sub>m</sub> - Load Distribution Factor:</label>
                    <input type="number" id="Km" step="any" value="1.0" oninput="markAsUser('Km'); calculate()">
                </div>
                <div class="input-row">
                    <label>K<sub>s</sub> - Size Factor:</label>
                    <input type="number" id="Ks" step="any" value="1.0" oninput="markAsUser('Ks'); calculate()">
                </div>
                <div class="input-row">
                    <label>K<sub>B</sub> - Rim Thickness Factor:</label>
                    <input type="number" id="KB" step="any" value="1.0" oninput="markAsUser('KB'); calculate()">
                </div>
                <div class="input-row">
                    <label>C<sub>p</sub> - Elastic Coefficient:</label>
                    <input type="number" id="Cp" step="any" oninput="markAsUser('Cp'); calculate()">
                </div>
                <div class="note">ðŸ“Š Typically 2300 for steel (<a href="#" onclick="goToPage(8)">Table 8-8</a>)</div>
                <div class="input-row">
                    <label>K<sub>R</sub> - Reliability Factor:</label>
                    <input type="number" id="KR" step="any" value="1.0" oninput="markAsUser('KR'); calculate()">
                </div>
                <div class="note">Typically 1.0 for 99% reliability</div>
            </div>

            <div class="section">
                <h2>Spur Step 35: Bending Strength</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$W_t = \frac{33000 \times P_{des}}{V_t}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>W<sub>t</sub> (lb) =</label>
                            <input type="number" id="Wt" step="any" oninput="markAsUser('Wt'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{tP} = \frac{W_t P_d}{F J_P} K_O K_s K_m K_B K_v$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ïƒ<sub>tP</sub> (psi) =</label>
                            <input type="number" id="stP" step="any" oninput="markAsUser('stP'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{tG} = \frac{W_t P_d}{F J_G} K_O K_s K_m K_B K_v$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ïƒ<sub>tG</sub> (psi) =</label>
                            <input type="number" id="stG" step="any" oninput="markAsUser('stG'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{acP} = \frac{\sigma_{tP}}{Y_N}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ïƒ<sub>acP</sub> (psi) =</label>
                            <input type="number" id="sacP" step="any" oninput="markAsUser('sacP'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>Ïƒ<sub>tP</sub></label>
                            <input type="number" id="stP_eq" step="any" oninput="syncInput('stP', 'stP_eq')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>Y<sub>N</sub></label>
                            <input type="number" id="YN_eq" step="any" oninput="syncInput('YN', 'YN_eq')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{acG} = \frac{\sigma_{tG}}{Y_N}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ïƒ<sub>acG</sub> (psi) =</label>
                            <input type="number" id="sacG" step="any" oninput="markAsUser('sacG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>Ïƒ<sub>tG</sub></label>
                            <input type="number" id="stG_eq" step="any" oninput="syncInput('stG', 'stG_eq')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>Y<sub>N</sub></label>
                            <input type="number" id="YN_eq2" step="any" oninput="syncInput('YN', 'YN_eq2')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Spur Step 36: Contact Strength</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_c = C_p \sqrt{\frac{W_t K_O K_s K_m K_v}{F D_P I}}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ïƒ<sub>c</sub> (psi) =</label>
                            <input type="number" id="sc" step="any" oninput="markAsUser('sc'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{ac} = \frac{\sigma_c}{Z_N}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Ïƒ<sub>ac</sub> (psi) =</label>
                            <input type="number" id="sac" step="any" oninput="markAsUser('sac'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>Ïƒ<sub>c</sub></label>
                            <input type="number" id="sc_eq" step="any" oninput="syncInput('sc', 'sc_eq')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>Z<sub>N</sub></label>
                            <input type="number" id="ZN_eq" step="any" oninput="syncInput('ZN', 'ZN_eq')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Spur Step 38: Design Allowable Strengths</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$S_{acP} = \sigma_{acP} \times K_R$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>S<sub>acP</sub> (psi) =</label>
                            <input type="number" id="SacP" step="any" oninput="markAsUser('SacP'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>Ïƒ<sub>acP</sub></label>
                            <input type="number" id="sacP_eq" step="any" oninput="syncInput('sacP', 'sacP_eq')">
                        </div>
                        <span>Ã—</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq" step="any" oninput="syncInput('KR', 'KR_eq')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$S_{acG} = \sigma_{acG} \times K_R$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>S<sub>acG</sub> (psi) =</label>
                            <input type="number" id="SacG" step="any" oninput="markAsUser('SacG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>Ïƒ<sub>acG</sub></label>
                            <input type="number" id="sacG_eq" step="any" oninput="syncInput('sacG', 'sacG_eq')">
                        </div>
                        <span>Ã—</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq2" step="any" oninput="syncInput('KR', 'KR_eq2')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$S_{ac} = \sigma_{ac} \times K_R$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>S<sub>ac</sub> (psi) =</label>
                            <input type="number" id="Sac" step="any" oninput="markAsUser('Sac'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>Ïƒ<sub>ac</sub></label>
                            <input type="number" id="sac_eq2" step="any" oninput="syncInput('sac', 'sac_eq2')">
                        </div>
                        <span>Ã—</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq3" step="any" oninput="syncInput('KR', 'KR_eq3')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Spur Step 39-40: Required Hardness</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$HB_{P,bending} = \frac{S_{acP}/1000 - 12.8}{0.0773}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>HB<sub>P,b</sub> =</label>
                            <input type="number" id="HB_b_P" step="any" oninput="markAsUser('HB_b_P'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$HB_{G,bending} = \frac{S_{acG}/1000 - 12.8}{0.0773}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>HB<sub>G,b</sub> =</label>
                            <input type="number" id="HB_b_G" step="any" oninput="markAsUser('HB_b_G'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$HB_{contact} = \frac{S_{ac}/1000 - 29.10}{0.322}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>HB<sub>c</sub> =</label>
                            <input type="number" id="HB_c" step="any" oninput="markAsUser('HB_c'); calculate()">
                        </div>
                    </div>
                </div>
                <div class="note">ðŸ“Š Select material from <a href="#" onclick="goToPage(9)">Table 8-6</a> that meets or exceeds these values</div>
            </div>


            </div>
            <!-- End Procedure Tab -->

            <!-- General Equations Tab -->
            <div id="equations-tab" class="tab-content">
                <div class="section">
                    <h2>Angle Relationships</h2>
                    <div class="equation-block">
                        <div class="equation-latex">$$\tan \phi_n = \tan \phi_t \cos \psi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>Ï†<sub>n</sub> (Â°)</label>
                                <input type="number" id="phi_n_eq" step="any" oninput="syncAllInstances('phi_n_eq'); markAsUser('phi_n_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ï†<sub>t</sub> (Â°)</label>
                                <input type="number" id="phi_t_eq" step="any" oninput="syncAllInstances('phi_t_eq'); markAsUser('phi_t_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ïˆ (Â°)</label>
                                <input type="number" id="psi_eq" step="any" oninput="syncAllInstances('psi_eq'); markAsUser('psi_eq'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Angle relationship between normal and transverse pressure angles</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Pitch Relationships</h2>
                    <div class="equation-block">
                        <div class="equation-latex">$$p_t = \frac{D_P}{N_P} = \frac{D_G}{N_G} = \frac{\pi}{P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>p<sub>t</sub> (in)</label>
                                <input type="number" id="pt_eqg" step="any" oninput="syncAllInstances('pt_eqg'); markAsUser('pt_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>P</sub> (in)</label>
                                <input type="number" id="DP_eqg" step="any" oninput="syncAllInstances('DP_eqg'); markAsUser('DP_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>P</sub></label>
                                <input type="number" id="NP_eqg" step="1" oninput="syncAllInstances('NP_eqg'); markAsUser('NP_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>G</sub> (in)</label>
                                <input type="number" id="DG_eqg" step="any" oninput="syncAllInstances('DG_eqg'); markAsUser('DG_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>G</sub></label>
                                <input type="number" id="NG_eqg" step="1" oninput="syncAllInstances('NG_eqg'); markAsUser('NG_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eqg" step="any" oninput="syncAllInstances('Pd_eqg'); markAsUser('Pd_eqg'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Transverse circular pitch</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$p_n = p_t \cos \psi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>p<sub>n</sub> (in)</label>
                                <input type="number" id="pn_eqg" step="any" oninput="syncAllInstances('pn_eqg'); markAsUser('pn_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>p<sub>t</sub> (in)</label>
                                <input type="number" id="pt_eqg2" step="any" oninput="syncAllInstances('pt_eqg2'); markAsUser('pt_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ïˆ (Â°)</label>
                                <input type="number" id="psi_eqg2" step="any" oninput="syncAllInstances('psi_eqg2'); markAsUser('psi_eqg2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Normal circular pitch</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$p_x = \frac{p_t}{\tan \psi} = \frac{\pi}{P_d \tan \psi} = m\pi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>p<sub>x</sub> (in)</label>
                                <input type="number" id="px_eqg" step="any" oninput="syncAllInstances('px_eqg'); markAsUser('px_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>p<sub>t</sub> (in)</label>
                                <input type="number" id="pt_eqg3" step="any" oninput="syncAllInstances('pt_eqg3'); markAsUser('pt_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ïˆ (Â°)</label>
                                <input type="number" id="psi_eqg3" step="any" oninput="syncAllInstances('psi_eqg3'); markAsUser('psi_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eqg2" step="any" oninput="syncAllInstances('Pd_eqg2'); markAsUser('Pd_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>m (mm)</label>
                                <input type="number" id="m_eqg" step="any" oninput="syncAllInstances('m_eqg'); markAsUser('m_eqg'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Axial pitch</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$P_d = \frac{N}{D}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eqg3" step="any" oninput="syncAllInstances('Pd_eqg3'); markAsUser('Pd_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N</label>
                                <input type="number" id="N_eqg" step="1" oninput="syncAllInstances('N_eqg'); markAsUser('N_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D (in)</label>
                                <input type="number" id="D_eqg" step="any" oninput="syncAllInstances('D_eqg'); markAsUser('D_eqg'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Diametral pitch</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$P_{nd} = P_d \cos \psi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>P<sub>nd</sub> (teeth/in)</label>
                                <input type="number" id="Pnd_eqg" step="any" oninput="syncAllInstances('Pnd_eqg'); markAsUser('Pnd_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eqg4" step="any" oninput="syncAllInstances('Pd_eqg4'); markAsUser('Pd_eqg4'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ïˆ (Â°)</label>
                                <input type="number" id="psi_eqg4" step="any" oninput="syncAllInstances('psi_eqg4'); markAsUser('psi_eqg4'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Normal diametral pitch</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$m = \frac{D}{N}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>m (mm)</label>
                                <input type="number" id="m_eqg2" step="any" oninput="syncAllInstances('m_eqg2'); markAsUser('m_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D (in)</label>
                                <input type="number" id="D_eqg2" step="any" oninput="syncAllInstances('D_eqg2'); markAsUser('D_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N</label>
                                <input type="number" id="N_eqg2" step="1" oninput="syncAllInstances('N_eqg2'); markAsUser('N_eqg2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Metric module</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$m_n = \frac{\cos \psi}{P_d} = \frac{D \cos \psi}{N} = m \cos \psi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>m<sub>n</sub> (mm)</label>
                                <input type="number" id="mn_eqg" step="any" oninput="syncAllInstances('mn_eqg'); markAsUser('mn_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ïˆ (Â°)</label>
                                <input type="number" id="psi_eqg5" step="any" oninput="syncAllInstances('psi_eqg5'); markAsUser('psi_eqg5'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eqg5" step="any" oninput="syncAllInstances('Pd_eqg5'); markAsUser('Pd_eqg5'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D (in)</label>
                                <input type="number" id="D_eqg3" step="any" oninput="syncAllInstances('D_eqg3'); markAsUser('D_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N</label>
                                <input type="number" id="N_eqg3" step="1" oninput="syncAllInstances('N_eqg3'); markAsUser('N_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>m (mm)</label>
                                <input type="number" id="m_eqg3" step="any" oninput="syncAllInstances('m_eqg3'); markAsUser('m_eqg3'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Normal metric module</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Face Contact Ratio</h2>
                    <div class="equation-block">
                        <div class="equation-latex">$$\text{Face Contact Ratio} = \frac{F}{p_x} > 2.0$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>FCR</label>
                                <input type="number" id="fcr_eqg" step="any" oninput="syncAllInstances('fcr_eqg'); markAsUser('fcr_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>F (in)</label>
                                <input type="number" id="F_eqg" step="any" oninput="syncAllInstances('F_eqg'); markAsUser('F_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>p<sub>x</sub> (in)</label>
                                <input type="number" id="px_eqg2" step="any" oninput="syncAllInstances('px_eqg2'); markAsUser('px_eqg2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Should be greater than 2.0</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Forces and Motion</h2>
                    <div class="equation-block">
                        <div class="equation-latex">$$T = \frac{63000P}{n}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>T (lbfÂ·in)</label>
                                <input type="number" id="T_eqg" step="any" oninput="syncAllInstances('T_eqg'); markAsUser('T_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P (hp)</label>
                                <input type="number" id="P_eqg" step="any" oninput="syncAllInstances('P_eqg'); markAsUser('P_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>n (rpm)</label>
                                <input type="number" id="n_eqg" step="any" oninput="syncAllInstances('n_eqg'); markAsUser('n_eqg'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Torque</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$v_t = \frac{\pi D n}{12}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>v<sub>t</sub> (ft/min)</label>
                                <input type="number" id="vt_eqg" step="any" oninput="syncAllInstances('vt_eqg'); markAsUser('vt_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D (in)</label>
                                <input type="number" id="D_eqg4" step="any" oninput="syncAllInstances('D_eqg4'); markAsUser('D_eqg4'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>n (rpm)</label>
                                <input type="number" id="n_eqg2" step="any" oninput="syncAllInstances('n_eqg2'); markAsUser('n_eqg2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Pitch line speed</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$W_t = \frac{33000P}{v_t} = \frac{126000P}{nD}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>W<sub>t</sub> (lbf)</label>
                                <input type="number" id="Wt_eqg" step="any" oninput="syncAllInstances('Wt_eqg'); markAsUser('Wt_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P (hp)</label>
                                <input type="number" id="P_eqg2" step="any" oninput="syncAllInstances('P_eqg2'); markAsUser('P_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>v<sub>t</sub> (ft/min)</label>
                                <input type="number" id="vt_eqg2" step="any" oninput="syncAllInstances('vt_eqg2'); markAsUser('vt_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>n (rpm)</label>
                                <input type="number" id="n_eqg3" step="any" oninput="syncAllInstances('n_eqg3'); markAsUser('n_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D (in)</label>
                                <input type="number" id="D_eqg5" step="any" oninput="syncAllInstances('D_eqg5'); markAsUser('D_eqg5'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Tangential force</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$W_r = W_t \tan \phi_t$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>W<sub>r</sub> (lbf)</label>
                                <input type="number" id="Wr_eqg" step="any" oninput="syncAllInstances('Wr_eqg'); markAsUser('Wr_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>W<sub>t</sub> (lbf)</label>
                                <input type="number" id="Wt_eqg2" step="any" oninput="syncAllInstances('Wt_eqg2'); markAsUser('Wt_eqg2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ï†<sub>t</sub> (Â°)</label>
                                <input type="number" id="phi_t_eqg2" step="any" oninput="syncAllInstances('phi_t_eqg2'); markAsUser('phi_t_eqg2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Radial force</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$W_x = W_t \tan \psi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>W<sub>x</sub> (lbf)</label>
                                <input type="number" id="Wx_eqg" step="any" oninput="syncAllInstances('Wx_eqg'); markAsUser('Wx_eqg'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>W<sub>t</sub> (lbf)</label>
                                <input type="number" id="Wt_eqg3" step="any" oninput="syncAllInstances('Wt_eqg3'); markAsUser('Wt_eqg3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>Ïˆ (Â°)</label>
                                <input type="number" id="psi_eqg6" step="any" oninput="syncAllInstances('psi_eqg6'); markAsUser('psi_eqg6'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Axial force</p>
                    </div>
                </div>
            </div>
            <!-- End General Equations Tab -->

            <!-- Variables Tab -->
            <div id="variables-tab" class="tab-content">
                <table class="variables-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Description</th>
                            <th>Value</th>
                            <th>Unit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="var-category">
                            <td colspan="4">Basic Parameters</td>
                        </tr>
                        <tr>
                            <td>N<sub>P</sub></td>
                            <td>Number of teeth on pinion</td>
                            <td><input type="number" id="var_NP" step="1" oninput="syncVarInput('var_NP')"></td>
                            <td>teeth</td>
                        </tr>
                        <tr>
                            <td>N<sub>G</sub></td>
                            <td>Number of teeth on gear</td>
                            <td><input type="number" id="var_NG" step="1" oninput="syncVarInput('var_NG')"></td>
                            <td>teeth</td>
                        </tr>
                        <tr>
                            <td>D<sub>P</sub></td>
                            <td>Pitch diameter of pinion</td>
                            <td><input type="number" id="var_DP" step="any" oninput="syncVarInput('var_DP')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>D<sub>G</sub></td>
                            <td>Pitch diameter of gear</td>
                            <td><input type="number" id="var_DG" step="any" oninput="syncVarInput('var_DG')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>Ïˆ</td>
                            <td>Helix angle</td>
                            <td><input type="number" id="var_psi" step="any" oninput="syncVarInput('var_psi')"></td>
                            <td>degrees</td>
                        </tr>
                        <tr>
                            <td>Ï†<sub>n</sub></td>
                            <td>Normal pressure angle</td>
                            <td><input type="number" id="var_phi_n" step="any" oninput="syncVarInput('var_phi_n')"></td>
                            <td>degrees</td>
                        </tr>
                        <tr>
                            <td>Ï†<sub>t</sub></td>
                            <td>Transverse pressure angle</td>
                            <td><input type="number" id="var_phi_t" step="any" oninput="syncVarInput('var_phi_t')"></td>
                            <td>degrees</td>
                        </tr>
                        <tr>
                            <td>F</td>
                            <td>Face width</td>
                            <td><input type="number" id="var_F" step="any" oninput="syncVarInput('var_F')"></td>
                            <td>in</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Pitch Parameters</td>
                        </tr>
                        <tr>
                            <td>p<sub>t</sub></td>
                            <td>Transverse circular pitch</td>
                            <td><input type="number" id="var_pt" step="any" oninput="syncVarInput('var_pt')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>p<sub>n</sub></td>
                            <td>Normal circular pitch</td>
                            <td><input type="number" id="var_pn" step="any" oninput="syncVarInput('var_pn')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>p<sub>x</sub></td>
                            <td>Axial pitch</td>
                            <td><input type="number" id="var_px" step="any" oninput="syncVarInput('var_px')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>P<sub>d</sub></td>
                            <td>Diametral pitch</td>
                            <td><input type="number" id="var_Pd" step="any" oninput="syncVarInput('var_Pd')"></td>
                            <td>teeth/in</td>
                        </tr>
                        <tr>
                            <td>P<sub>nd</sub></td>
                            <td>Normal diametral pitch</td>
                            <td><input type="number" id="var_Pnd" step="any" oninput="syncVarInput('var_Pnd')"></td>
                            <td>teeth/in</td>
                        </tr>
                        <tr>
                            <td>m</td>
                            <td>Metric module</td>
                            <td><input type="number" id="var_m" step="any" oninput="syncVarInput('var_m')"></td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>m<sub>n</sub></td>
                            <td>Normal metric module</td>
                            <td><input type="number" id="var_mn" step="any" oninput="syncVarInput('var_mn')"></td>
                            <td>mm</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Power and Motion</td>
                        </tr>
                        <tr>
                            <td>P</td>
                            <td>Power</td>
                            <td><input type="number" id="var_P" step="any" oninput="syncVarInput('var_P')"></td>
                            <td>hp</td>
                        </tr>
                        <tr>
                            <td>n<sub>P</sub></td>
                            <td>Pinion speed</td>
                            <td><input type="number" id="var_nP" step="any" oninput="syncVarInput('var_nP')"></td>
                            <td>rpm</td>
                        </tr>
                        <tr>
                            <td>n<sub>G</sub></td>
                            <td>Gear speed</td>
                            <td><input type="number" id="var_nG" step="any" oninput="syncVarInput('var_nG')"></td>
                            <td>rpm</td>
                        </tr>
                        <tr>
                            <td>T</td>
                            <td>Torque</td>
                            <td><input type="number" id="var_T" step="any" oninput="syncVarInput('var_T')"></td>
                            <td>lbfÂ·in</td>
                        </tr>
                        <tr>
                            <td>v<sub>t</sub></td>
                            <td>Pitch line speed</td>
                            <td><input type="number" id="var_vt" step="any" oninput="syncVarInput('var_vt')"></td>
                            <td>ft/min</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Forces</td>
                        </tr>
                        <tr>
                            <td>W<sub>t</sub></td>
                            <td>Transmitted load</td>
                            <td><input type="number" id="var_Wt" step="any" oninput="syncVarInput('var_Wt')"></td>
                            <td>lbf</td>
                        </tr>
                        <tr>
                            <td>W<sub>r</sub></td>
                            <td>Radial load</td>
                            <td><input type="number" id="var_Wr" step="any" oninput="syncVarInput('var_Wr')"></td>
                            <td>lbf</td>
                        </tr>
                        <tr>
                            <td>W<sub>a</sub>, W<sub>x</sub></td>
                            <td>Axial load</td>
                            <td><input type="number" id="var_Wx" step="any" oninput="syncVarInput('var_Wx')"></td>
                            <td>lbf</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- End Variables Tab -->

        </div>
    </div>

    <script>
        const userValues = new Set();
        let crosshairsActive = false;
        let crosshairsFeatureEnabled = false;

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            const activeTab = document.getElementById(tabName + '-tab');
            activeTab.classList.add('active');
            event.currentTarget.classList.add('active');

            // Re-render MathJax for the new tab
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([activeTab]).catch((err) => console.log(err));
            }
        }

        // Map of all variable instances across all tabs
        const varInstanceMap = {
            'NP': ['NP', 'var_NP', 'NP_eq4', 'NP_eqg'],
            'NG': ['NG', 'var_NG', 'NG_eq5', 'NG_eqg'],
            'Pd': ['Pd', 'var_Pd', 'Pd_eq4', 'Pd_eq5', 'Pd_geq', 'Pd_eqg', 'Pd_eqg2', 'Pd_eqg3', 'Pd_eqg4', 'Pd_eqg5'],
            'DP': ['DP', 'var_DP', 'DP_eq6', 'DP_eq7', 'DP_eqg'],
            'DG': ['DG', 'var_DG', 'DG_eq6', 'DG_eqg'],
            'psi': ['psi', 'var_psi', 'psi_eq3', 'psi_eq', 'psi_eqg', 'psi_eqg2', 'psi_eqg3', 'psi_eqg4', 'psi_eqg5', 'psi_eqg6'],
            'phi_n': ['phi_n', 'var_phi_n', 'phi_n_eq', 'phi_n_eqg'],
            'phi_t': ['phi_t', 'var_phi_t', 'phi_t_eq', 'phi_t_eqg', 'phi_t_eqg2'],
            'F': ['F', 'var_F', 'F_eqg'],
            'pt': ['pt', 'var_pt', 'pt_eq', 'pt_eqg', 'pt_eqg2', 'pt_eqg3'],
            'pn': ['pn', 'var_pn', 'pn_eq', 'pn_eqg'],
            'px': ['px', 'var_px', 'px_eq', 'px_eqg', 'px_eqg2'],
            'Pnd': ['Pnd', 'var_Pnd', 'Pnd_eq3', 'Pnd_eq', 'Pnd_eqg'],
            'm': ['m', 'var_m', 'm_eq', 'm_eqg', 'm_eqg2', 'm_eqg3'],
            'mn': ['mn', 'var_mn', 'mn_eq', 'mn_eqg'],
            'P': ['P', 'var_P', 'P_eqg', 'P_eqg2'],
            'nP': ['nP', 'var_nP', 'nP_eq7'],
            'nG': ['nG', 'var_nG'],
            'n': ['n_eqg', 'n_eqg2', 'n_eqg3'],
            'N': ['N_eqg', 'N_eqg2', 'N_eqg3'],
            'D': ['D_eqg', 'D_eqg2', 'D_eqg3', 'D_eqg4', 'D_eqg5'],
            'T': ['T', 'var_T', 'T_geq', 'T_eqg'],
            'vt': ['vt', 'var_vt', 'vt_geq', 'vt_eqg', 'vt_eqg2'],
            'Wt': ['Wt', 'var_Wt', 'Wt_geq', 'Wt_eqg', 'Wt_eqg2', 'Wt_eqg3'],
            'Wr': ['Wr', 'var_Wr', 'Wr_geq', 'Wr_eqg'],
            'Wx': ['Wx', 'var_Wx', 'Wx_eq', 'Wx_eqg'],
            'fcr': ['fcr_eq', 'fcr_eqg']
        };

        function getBaseVarName(id) {
            if (id.startsWith('var_')) {
                return id.substring(4);
            }
            // Match patterns like: phi_n_eqg, phi_n_eqg2, phi_n_eq, phi_n_eq2, Pd_geq, etc.
            const eqMatch = id.match(/^(.+)_(eq|eqg|beq|beqg|geq)\d*$/);
            if (eqMatch) {
                return eqMatch[1];
            }
            return id;
        }

        function syncAllInstances(sourceId) {
            const baseVar = getBaseVarName(sourceId);
            const sourceEl = document.getElementById(sourceId);
            if (!sourceEl || !varInstanceMap[baseVar]) return;
            const value = sourceEl.value;
            varInstanceMap[baseVar].forEach(instanceId => {
                if (instanceId !== sourceId) {
                    const el = document.getElementById(instanceId);
                    if (el) el.value = value;
                }
            });
        }

        function markAsUser(varId) {
            userValues.add(varId);
            syncAllInstances(varId);
        }

        function syncVarInput(varId) {
            markAsUser(varId);
            calculate();
        }

        function syncInput(mainId, sourceId) {
            const sourceEl = document.getElementById(sourceId);
            const mainEl = document.getElementById(mainId);
            if (sourceEl && mainEl) {
                mainEl.value = sourceEl.value;
            }
            markAsUser(mainId);
            calculate();
        }

        function getValue(id) {
            const el = document.getElementById(id);
            if (!el) return null;
            const val = parseFloat(el.value);
            return isNaN(val) ? null : val;
        }

        function setValue(id, value) {
            if (value !== null && !isNaN(value) && isFinite(value)) {
                const el = document.getElementById(id);
                if (el) {
                    el.value = value.toFixed(4);
                    if (!userValues.has(id)) {
                        el.classList.add('computed');
                    }
                }
            }
        }

        function syncAllFields() {
            const mainVars = {
                'Pnd': ['Pnd', 'Pnd_eq3'],
                'psi': ['psi', 'psi_eq3'],
                'Pd': ['Pd', 'Pd_eq4', 'Pd_eq5'],
                'NP': ['NP', 'NP_eq4'],
                'NG': ['NG', 'NG_eq5'],
                'DP': ['DP', 'DP_eq6', 'DP_eq7'],
                'DG': ['DG', 'DG_eq6'],
                'nP': ['nP', 'nP_eq7'],
                'stP': ['stP', 'stP_eq'],
                'stG': ['stG', 'stG_eq'],
                'YN': ['YN', 'YN_eq', 'YN_eq2'],
                'ZN': ['ZN', 'ZN_eq'],
                'sc': ['sc', 'sc_eq'],
                'sacP': ['sacP', 'sacP_eq'],
                'sacG': ['sacG', 'sacG_eq'],
                'sac': ['sac', 'sac_eq2'],
                'KR': ['KR', 'KR_eq', 'KR_eq2', 'KR_eq3']
            };

            for (let mainVar in mainVars) {
                const mainEl = document.getElementById(mainVar);
                if (mainEl && mainEl.value) {
                    const value = mainEl.value;
                    mainVars[mainVar].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) {
                            el.value = value;
                        }
                    });
                }
            }
        }

        function calculate() {
            syncAllFields();

            const P = getValue('P');
            const KO = getValue('KO');
            const nP = getValue('nP');
            const NP = getValue('NP');
            const NG = getValue('NG');
            const psi = getValue('psi');
            const Pnd = getValue('Pnd');
            const F = getValue('F');
            const Kv = getValue('Kv');
            const phi_n = getValue('phi_n');
            const JP = getValue('JP');
            const JG = getValue('JG');
            const I = getValue('I');
            const YN = getValue('YN');
            const ZN = getValue('ZN');
            const Km = getValue('Km');
            const Ks = getValue('Ks');
            const KB = getValue('KB');
            const Cp = getValue('Cp');
            const KR = getValue('KR');

            // Step 3: Pd = Pnd * cos(psi)
            if (Pnd !== null && psi !== null && !userValues.has('Pd')) {
                const psiRad = psi * Math.PI / 180;
                const Pd = Pnd * Math.cos(psiRad);
                setValue('Pd', Pd);
            }

            const Pd = getValue('Pd');

            // Step 4-6: Geometry
            if (NP !== null && Pd && !userValues.has('DP')) {
                setValue('DP', NP / Pd);
            }
            if (NG !== null && Pd && !userValues.has('DG')) {
                setValue('DG', NG / Pd);
            }

            const DP = getValue('DP');
            const DG = getValue('DG');

            if (DP && DG && !userValues.has('C')) {
                setValue('C', (DP + DG) / 2);
            }

            // Step 7: Velocity
            if (DP && nP !== null && !userValues.has('Vt')) {
                setValue('Vt', Math.PI * DP * nP / 12);
            }

            const Vt = getValue('Vt');

            // Step 12: phi_t
            if (phi_n !== null && psi !== null && !userValues.has('phi_t')) {
                const psiRad = psi * Math.PI / 180;
                const phi_nRad = phi_n * Math.PI / 180;
                const phi_tRad = Math.atan(Math.tan(phi_nRad) / Math.cos(psiRad));
                setValue('phi_t', phi_tRad * 180 / Math.PI);
            }

            // Step 35: Wt and stresses
            if (P !== null && KO && Vt && !userValues.has('Wt')) {
                const Pdes = P * KO;
                setValue('Wt', 33000 * Pdes / Vt);
            }

            const Wt = getValue('Wt');

            if (Wt && Pd && F && JP && KO && Ks && Km && KB && Kv && !userValues.has('stP')) {
                setValue('stP', (Wt * Pd / (F * JP)) * KO * Ks * Km * KB * Kv);
            }

            if (Wt && Pd && F && JG && KO && Ks && Km && KB && Kv && !userValues.has('stG')) {
                setValue('stG', (Wt * Pd / (F * JG)) * KO * Ks * Km * KB * Kv);
            }

            const stP = getValue('stP');
            const stG = getValue('stG');

            if (stP && YN && !userValues.has('sacP')) {
                setValue('sacP', stP / YN);
            }
            if (stG && YN && !userValues.has('sacG')) {
                setValue('sacG', stG / YN);
            }

            // Contact stress
            if (Wt && KO && Ks && Km && Kv && F && DP && I && Cp && !userValues.has('sc')) {
                setValue('sc', Cp * Math.sqrt((Wt * KO * Ks * Km * Kv) / (F * DP * I)));
            }

            const sc = getValue('sc');

            if (sc && ZN && !userValues.has('sac')) {
                setValue('sac', sc / ZN);
            }

            const sacP = getValue('sacP');
            const sacG = getValue('sacG');
            const sac = getValue('sac');

            // Step 38: Design allowable strengths
            if (sacP && KR && !userValues.has('SacP')) {
                setValue('SacP', sacP * KR);
            }
            if (sacG && KR && !userValues.has('SacG')) {
                setValue('SacG', sacG * KR);
            }
            if (sac && KR && !userValues.has('Sac')) {
                setValue('Sac', sac * KR);
            }

            const SacP = getValue('SacP');
            const SacG = getValue('SacG');
            const Sac = getValue('Sac');

            // Required hardness
            if (SacP && !userValues.has('HB_b_P')) {
                setValue('HB_b_P', (SacP / 1000 - 12.8) / 0.0773);
            }
            if (SacG && !userValues.has('HB_b_G')) {
                setValue('HB_b_G', (SacG / 1000 - 12.8) / 0.0773);
            }
            if (Sac && !userValues.has('HB_c')) {
                setValue('HB_c', (Sac / 1000 - 29.10) / 0.322);
            }

            saveSession();
        }

        function saveSession() {
            const state = {};
            document.querySelectorAll('input[type="number"]').forEach(input => {
                if (input.value) state[input.id] = input.value;
            });
            state.userValues = Array.from(userValues);
            localStorage.setItem('helical_session', JSON.stringify(state));
        }

        function loadSession() {
            const saved = localStorage.getItem('helical_session');
            if (saved) {
                const state = JSON.parse(saved);
                userValues.clear();
                if (state.userValues) state.userValues.forEach(v => userValues.add(v));
                for (let key in state) {
                    const el = document.getElementById(key);
                    if (el && state[key]) {
                        el.value = state[key];
                        if (!userValues.has(key)) {
                            el.classList.add('computed');
                        }
                    }
                }
                calculate();
            }
        }

        function resetAll() {
            if (confirm('Reset all values?')) {
                localStorage.removeItem('helical_session');
                userValues.clear();
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.value = '';
                    input.classList.remove('computed');
                });
            }
        }

        function saveSessionManual() {
            saveSession();
            alert('Session saved successfully! âœ“');
        }

        // Initialize crosshairs functionality
        function initCrosshairs() {
            const pdfContainer = document.querySelector('.pdf-container');
            const clickOverlay = document.getElementById('click-overlay');
            const svg = document.getElementById('pdf-crosshairs');
            const verticalLine = document.getElementById('crosshair-vertical');
            const horizontalLine = document.getElementById('crosshair-horizontal');

            if (!pdfContainer || !clickOverlay || !svg || !verticalLine || !horizontalLine) return;

            // Start with overlay hidden (PDF fully interactive by default)
            clickOverlay.style.display = 'none';

            // Listen for clicks on the click overlay - toggle crosshairs on/off
            clickOverlay.addEventListener('click', function(e) {
                if (!crosshairsActive) {
                    // SHOW CROSSHAIRS
                    const rect = pdfContainer.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    verticalLine.setAttribute('x1', x);
                    verticalLine.setAttribute('x2', x);
                    verticalLine.setAttribute('y2', rect.height);

                    horizontalLine.setAttribute('y1', y);
                    horizontalLine.setAttribute('y2', y);
                    horizontalLine.setAttribute('x2', rect.width);

                    verticalLine.classList.add('active');
                    horizontalLine.classList.add('active');
                    crosshairsActive = true;
                } else {
                    // HIDE CROSSHAIRS
                    verticalLine.classList.remove('active');
                    horizontalLine.classList.remove('active');
                    crosshairsActive = false;
                }
            });
        }

        // Toggle crosshairs feature on/off
        function toggleCrosshairsFeature() {
            const clickOverlay = document.getElementById('click-overlay');
            const toggleBtn = document.getElementById('toggle-crosshairs-btn');
            const verticalLine = document.getElementById('crosshair-vertical');
            const horizontalLine = document.getElementById('crosshair-horizontal');

            if (!clickOverlay || !toggleBtn) return;

            crosshairsFeatureEnabled = !crosshairsFeatureEnabled;

            if (crosshairsFeatureEnabled) {
                // ENABLE CROSSHAIRS FEATURE
                clickOverlay.style.display = 'block';
                toggleBtn.textContent = 'ðŸŽ¯ Disable Crosshairs';
                toggleBtn.classList.add('active');
            } else {
                // DISABLE CROSSHAIRS FEATURE
                clickOverlay.style.display = 'none';
                toggleBtn.textContent = 'ðŸŽ¯ Enable Crosshairs';
                toggleBtn.classList.remove('active');

                // Also hide any active crosshairs
                if (crosshairsActive) {
                    verticalLine.classList.remove('active');
                    horizontalLine.classList.remove('active');
                    crosshairsActive = false;
                }
            }
        }

        // PDF Page Navigation
        function goToPage(page) {
            const embed = document.getElementById("pdf");
            const currSrc = embed.src.split('#')[0];

            // Force complete reload by clearing and resetting with delay
            embed.src = '';
            setTimeout(() => {
                embed.src = `${currSrc}#page=${page}`;
            }, 50);
        }

        window.addEventListener('DOMContentLoaded', () => {
            initCrosshairs();
            loadSession();
            MathJax.typesetPromise();
        });
    </script>
</body>
</html>
