<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spur Gear Design Guide (Fizz)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .pdf-column {
            flex: 1;
            background: #2c3e50;
            padding: 20px;
            overflow-y: auto;
            max-height: 95vh;
        }

        /* PDF Container for Crosshairs */
        .pdf-container {
            position: relative;
            width: 100%;
            height: 100%;
            flex: 1;
            display: flex;
        }
        .pdf-column embed,
        .pdf-column iframe {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* PDF Crosshairs Feature */
        .click-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            cursor: crosshair;
        }
        .crosshairs-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        .crosshair-line {
            stroke: #ff0000;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .crosshair-line.active {
            opacity: 0.8;
        }
        .calculator-column {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            max-height: 95vh;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }
        h2 {
            color: #3498db;
            margin: 20px 0 10px;
            font-size: 1.1em;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            margin: 12px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .equation-block {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .equation-latex {
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            text-align: center;
        }
        .equation-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .var-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .var-input label {
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }
        .var-input input {
            width: 100px;
            padding: 8px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
            text-align: center;
        }
        .var-input input:focus {
            outline: none;
            border-color: #3498db;
        }
        .var-input input.computed {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .equation-inputs > span {
            font-size: 1.2em;
            font-weight: bold;
            color: #666;
            margin: 0 5px;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .input-row label {
            min-width: 200px;
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }
        .input-row input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9em;
        }
        .input-row input:focus {
            outline: none;
            border-color: #3498db;
        }
        .input-row input.computed {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .hint {
            font-size: 0.85em;
            color: #666;
            margin-left: 10px;
        }
        /* Button Group */
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 100;
            padding: 15px 0;
            margin-top: -15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            flex: 1;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .save-btn {
            background: #28a745;
            color: white;
        }
        .save-btn:hover {
            background: #218838;
        }
        .reset-btn {
            background: #dc3545;
            color: white;
        }
        .reset-btn:hover {
            background: #c82333;
        }
        .toggle-crosshairs-btn {
            background: #6c757d;
            color: white;
        }
        .toggle-crosshairs-btn:hover {
            background: #5a6268;
        }
        .toggle-crosshairs-btn.active {
            background: #28a745;
        }
        .toggle-crosshairs-btn.active:hover {
            background: #218838;
        }

        /* PDF Navigation Links */
        .warning-box a,
        .info-box a {
            color: #0066cc;
            text-decoration: underline;
            font-weight: 600;
            cursor: pointer;
        }
        .warning-box a:hover,
        .info-box a:hover {
            color: #004499;
        }
        .summary-section {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
        }
        .summary-section h2 {
            color: white;
            border-left-color: white;
        }

        /* Tab System */
        .tabs {
            display: flex;
            border-bottom: 2px solid #3498db;
            margin-bottom: 20px;
            gap: 5px;
        }
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #7f8c8d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab-button:hover {
            color: #3498db;
            background: #f8f9fa;
        }
        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Variables Table */
        .variables-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .variables-table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .variables-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        .variables-table tr:hover {
            background: #f8f9fa;
        }
        .variables-table input {
            width: 120px;
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .variables-table input:focus {
            outline: none;
            border-color: #3498db;
        }
        .variables-table input.computed {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .var-category {
            background: #e3f2fd;
            font-weight: 600;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pdf-column">
            <div class="pdf-container">
                <embed src="../../documents/gears/fizz_spur.pdf" type="application/pdf" id="pdf">
                <div class="click-overlay" id="click-overlay"></div>
                <svg id="pdf-crosshairs" class="crosshairs-overlay">
                    <line id="crosshair-vertical" class="crosshair-line" x1="0" y1="0" x2="0" y2="100%" />
                    <line id="crosshair-horizontal" class="crosshair-line" x1="0" y1="0" x2="100%" y2="0" />
                </svg>
            </div>
        </div>
        <div class="calculator-column">
            <h1>Spur Gear Design Guide</h1>
            <div class="info-box">
                ⚠️ This follows the Fizz design process. Many parameters require manual lookup from tables/graphs in the PDF. Reference the PDF for complete design process (40 steps total).
            </div>

            <!-- Button Group -->
            <div class="button-group">
                <button class="save-btn" onclick="saveSessionManual()">💾 Save Session</button>
                <button class="reset-btn" onclick="resetAll()">🔄 Reset All</button>
                <button class="toggle-crosshairs-btn" id="toggle-crosshairs-btn" onclick="toggleCrosshairsFeature()">🎯 Enable Crosshairs</button>
            </div>

            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('procedure')">Procedure</button>
                <button class="tab-button" onclick="showTab('equations')">General Equations</button>
                <button class="tab-button" onclick="showTab('variables')">Variables</button>
            </div>

            <!-- Procedure Tab -->
            <div id="procedure-tab" class="tab-content active">
            <div class="section">
                <h2>Basic Input Parameters</h2>
                <div class="input-row">
                    <label>Power (P) [hp]:</label>
                    <input type="number" id="P" step="any" oninput="markAsUser('P'); calculate()">
                </div>
                <div class="input-row">
                    <label>Input Speed (n<sub>P</sub>) [rpm]:</label>
                    <input type="number" id="nP" step="any" oninput="markAsUser('nP'); calculate()">
                </div>
                <div class="input-row">
                    <label>Overload Factor (K<sub>O</sub>):</label>
                    <input type="number" id="KO" value="1.25" step="any" oninput="markAsUser('KO'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(1); return false;">Table 9-1</a>)</span>
                </div>
                <div class="input-row">
                    <label>Diametral Pitch (P<sub>d</sub>):</label>
                    <input type="number" id="Pd" step="any" oninput="markAsUser('Pd'); calculate()">
                    <span class="hint">(Step 4 graph)</span>
                </div>
                <div class="input-row">
                    <label>Number of Pinion Teeth (N<sub>P</sub>):</label>
                    <input type="number" id="NP" value="18" step="1" oninput="markAsUser('NP'); calculate()">
                </div>
                <div class="input-row">
                    <label>Number of Gear Teeth (N<sub>G</sub>):</label>
                    <input type="number" id="NG" step="1" oninput="markAsUser('NG'); calculate()">
                </div>
                <div class="input-row">
                    <label>Face Width (F) [in]:</label>
                    <input type="number" id="F" step="any" oninput="markAsUser('F'); calculate()">
                    <span class="hint">(12/P<sub>d</sub> nominal)</span>
                </div>
            </div>

            <div class="section">
                <h2>Step 1: Design Power</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$P_{des} = P \times K_O$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>P<sub>des</sub> (hp) =</label>
                            <input type="number" id="Pdes" step="any" oninput="markAsUser('Pdes'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>P</label>
                            <input type="number" id="P_eq1" step="any" oninput="syncInput('P', 'P_eq1')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>K<sub>O</sub></label>
                            <input type="number" id="KO_eq1" step="any" oninput="syncInput('KO', 'KO_eq1')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 2-3: Pitch Diameters</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$D_P = \frac{N_P}{P_d}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>D<sub>P</sub> (in) =</label>
                            <input type="number" id="DP" step="any" oninput="markAsUser('DP'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>N<sub>P</sub></label>
                            <input type="number" id="NP_eq2" step="1" oninput="syncInput('NP', 'NP_eq2')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_eq2" step="any" oninput="syncInput('Pd', 'Pd_eq2')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$D_G = \frac{N_G}{P_d}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>D<sub>G</sub> (in) =</label>
                            <input type="number" id="DG" step="any" oninput="markAsUser('DG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_eq3" step="1" oninput="syncInput('NG', 'NG_eq3')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_eq3" step="any" oninput="syncInput('Pd', 'Pd_eq3')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 4: Center Distance</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$C = \frac{D_P + D_G}{2}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>C (in) =</label>
                            <input type="number" id="C" step="any" oninput="markAsUser('C'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(</span>
                        <div class="var-input">
                            <label>D<sub>P</sub></label>
                            <input type="number" id="DP_eq4" step="any" oninput="syncInput('DP', 'DP_eq4')">
                        </div>
                        <span>+</span>
                        <div class="var-input">
                            <label>D<sub>G</sub></label>
                            <input type="number" id="DG_eq4" step="any" oninput="syncInput('DG', 'DG_eq4')">
                        </div>
                        <span>) / 2</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 5: Pitch Line Velocity</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$v_t = \frac{\pi D_P n_P}{12}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>v<sub>t</sub> (ft/min) =</label>
                            <input type="number" id="vt" step="any" oninput="markAsUser('vt'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(π ×</span>
                        <div class="var-input">
                            <label>D<sub>P</sub></label>
                            <input type="number" id="DP_eq5" step="any" oninput="syncInput('DP', 'DP_eq5')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>n<sub>P</sub></label>
                            <input type="number" id="nP_eq5" step="any" oninput="syncInput('nP', 'nP_eq5')">
                        </div>
                        <span>) / 12</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 6: Transmitted Load</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$W_t = \frac{33000 \times P}{v_t}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>W<sub>t</sub> (lbf) =</label>
                            <input type="number" id="Wt" step="any" oninput="markAsUser('Wt'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(33000 ×</span>
                        <div class="var-input">
                            <label>P</label>
                            <input type="number" id="P_eq6" step="any" oninput="syncInput('P', 'P_eq6')">
                        </div>
                        <span>) /</span>
                        <div class="var-input">
                            <label>v<sub>t</sub></label>
                            <input type="number" id="vt_eq6" step="any" oninput="syncInput('vt', 'vt_eq6')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Stress Analysis Factors</h2>
                <div class="info-box">
                    📊 <strong>MANUAL LOOKUP REQUIRED</strong> - These require manual lookup from PDF graphs/tables. Click table/figure references to jump to the page.
                </div>
                <div class="input-row">
                    <label>Quality Number (A<sub>v</sub>):</label>
                    <input type="number" id="Av" value="6" step="1" oninput="markAsUser('Av'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(3); return false;">Table 9-5</a>)</span>
                </div>
                <div class="input-row">
                    <label>Dynamic Factor (K<sub>v</sub>):</label>
                    <input type="number" id="Kv" step="any" oninput="markAsUser('Kv'); calculate()">
                    <span class="hint">(Step 17 graph - see PDF)</span>
                </div>
                <div class="input-row">
                    <label>Bending Factor Pinion (J<sub>P</sub>):</label>
                    <input type="number" id="JP" step="any" oninput="markAsUser('JP'); calculate()">
                    <span class="hint">(Step 18 graph - see PDF)</span>
                </div>
                <div class="input-row">
                    <label>Bending Factor Gear (J<sub>G</sub>):</label>
                    <input type="number" id="JG" step="any" oninput="markAsUser('JG'); calculate()">
                    <span class="hint">(Step 18 graph - see PDF)</span>
                </div>
                <div class="input-row">
                    <label>Pitting Geometry Factor (I):</label>
                    <input type="number" id="I" step="any" oninput="markAsUser('I'); calculate()">
                    <span class="hint">(Step 19 graph - see PDF)</span>
                </div>
                <div class="input-row">
                    <label>Load Distribution (K<sub>m</sub>):</label>
                    <input type="number" id="Km" value="1.6" step="any" oninput="markAsUser('Km'); calculate()">
                    <span class="hint">(Steps 20-22 - see PDF)</span>
                </div>
                <div class="input-row">
                    <label>Size Factor (K<sub>s</sub>):</label>
                    <input type="number" id="Ks" value="1" step="any" oninput="markAsUser('Ks'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(2); return false;">Table 9-2</a>)</span>
                </div>
                <div class="input-row">
                    <label>Rim Thickness (K<sub>B</sub>):</label>
                    <input type="number" id="KB" value="1" step="any" oninput="markAsUser('KB'); calculate()">
                    <span class="hint">(Step 23 - see PDF)</span>
                </div>
                <div class="input-row">
                    <label>Elastic Coefficient (C<sub>P</sub>):</label>
                    <input type="number" id="CP" value="2300" step="any" oninput="markAsUser('CP'); calculate()">
                    <span class="hint">(2300 for steel - <a href="#" onclick="goToPage(4); return false;">Table 9-7</a>)</span>
                </div>
            </div>

            <div class="section">
                <h2>Step 7-8: Bending Stress</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{tP} = \frac{W_t P_d}{F J_P} K_O K_s K_m K_B K_v$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>tP</sub> (psi) =</label>
                            <input type="number" id="stP" step="any" oninput="markAsUser('stP'); calculate()">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{tG} = \sigma_{tP} \times \frac{J_P}{J_G}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>tG</sub> (psi) =</label>
                            <input type="number" id="stG" step="any" oninput="markAsUser('stG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>σ<sub>tP</sub></label>
                            <input type="number" id="stP_eq8" step="any" oninput="syncInput('stP', 'stP_eq8')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>J<sub>P</sub></label>
                            <input type="number" id="JP_eq8" step="any" oninput="syncInput('JP', 'JP_eq8')">
                        </div>
                        <span>/</span>
                        <div class="var-input">
                            <label>J<sub>G</sub></label>
                            <input type="number" id="JG_eq8" step="any" oninput="syncInput('JG', 'JG_eq8')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Step 9: Contact Stress</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_c = C_P \sqrt{\frac{W_t K_O K_s K_m K_v}{F D_P I}}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>c</sub> (psi) =</label>
                            <input type="number" id="sc" step="any" oninput="markAsUser('sc'); calculate()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Life/Reliability Factors</h2>
                <div class="info-box">
                    📊 <strong>MANUAL LOOKUP REQUIRED</strong> - Cycle factors based on expected number of load cycles. Click references to jump to the page.
                </div>
                <div class="input-row">
                    <label>Service Factor (SF):</label>
                    <input type="number" id="SF" value="1" step="any" oninput="markAsUser('SF'); calculate()">
                    <span class="hint">(Default 1.0)</span>
                </div>
                <div class="input-row">
                    <label>Reliability Factor (K<sub>R</sub>):</label>
                    <input type="number" id="KR" value="1" step="any" oninput="markAsUser('KR'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(5); return false;">Table 9-11</a>)</span>
                </div>
                <div class="input-row">
                    <label>Bending Cycle Pinion (Y<sub>N,P</sub>):</label>
                    <input type="number" id="YNP" step="any" oninput="markAsUser('YNP'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(6); return false;">Fig 9-21</a>)</span>
                </div>
                <div class="input-row">
                    <label>Bending Cycle Gear (Y<sub>N,G</sub>):</label>
                    <input type="number" id="YNG" step="any" oninput="markAsUser('YNG'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(6); return false;">Fig 9-21</a>)</span>
                </div>
                <div class="input-row">
                    <label>Pitting Cycle Pinion (Z<sub>N,P</sub>):</label>
                    <input type="number" id="ZNP" step="any" oninput="markAsUser('ZNP'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(7); return false;">Fig 9-22</a>)</span>
                </div>
                <div class="input-row">
                    <label>Pitting Cycle Gear (Z<sub>N,G</sub>):</label>
                    <input type="number" id="ZNG" step="any" oninput="markAsUser('ZNG'); calculate()">
                    <span class="hint">(<a href="#" onclick="goToPage(7); return false;">Fig 9-22</a>)</span>
                </div>
            </div>

            <div class="section">
                <h2>Required Bending Strengths</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{at,P} = \sigma_{tP} \times \frac{K_R \times SF}{Y_{N,P}}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>at,P</sub> (psi) =</label>
                            <input type="number" id="satP" step="any" oninput="markAsUser('satP'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>σ<sub>tP</sub></label>
                            <input type="number" id="stP_eq10" step="any" oninput="syncInput('stP', 'stP_eq10')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq10" step="any" oninput="syncInput('KR', 'KR_eq10')">
                        </div>
                        <span>× SF /</span>
                        <div class="var-input">
                            <label>Y<sub>N,P</sub></label>
                            <input type="number" id="YNP_eq10" step="any" oninput="syncInput('YNP', 'YNP_eq10')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{at,G} = \sigma_{tG} \times \frac{K_R \times SF}{Y_{N,G}}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>at,G</sub> (psi) =</label>
                            <input type="number" id="satG" step="any" oninput="markAsUser('satG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>σ<sub>tG</sub></label>
                            <input type="number" id="stG_eq11" step="any" oninput="syncInput('stG', 'stG_eq11')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq11" step="any" oninput="syncInput('KR', 'KR_eq11')">
                        </div>
                        <span>× SF /</span>
                        <div class="var-input">
                            <label>Y<sub>N,G</sub></label>
                            <input type="number" id="YNG_eq11" step="any" oninput="syncInput('YNG', 'YNG_eq11')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Required Contact Strengths</h2>
                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{ac,P} = \sigma_c \times \frac{K_R \times SF}{Z_{N,P}}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>ac,P</sub> (psi) =</label>
                            <input type="number" id="sacP" step="any" oninput="markAsUser('sacP'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>σ<sub>c</sub></label>
                            <input type="number" id="sc_eq12" step="any" oninput="syncInput('sc', 'sc_eq12')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq12" step="any" oninput="syncInput('KR', 'KR_eq12')">
                        </div>
                        <span>× SF /</span>
                        <div class="var-input">
                            <label>Z<sub>N,P</sub></label>
                            <input type="number" id="ZNP_eq12" step="any" oninput="syncInput('ZNP', 'ZNP_eq12')">
                        </div>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$\sigma_{ac,G} = \sigma_c \times \frac{K_R \times SF}{Z_{N,G}}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>σ<sub>ac,G</sub> (psi) =</label>
                            <input type="number" id="sacG" step="any" oninput="markAsUser('sacG'); calculate()">
                        </div>
                        <span>=</span>
                        <div class="var-input">
                            <label>σ<sub>c</sub></label>
                            <input type="number" id="sc_eq13" step="any" oninput="syncInput('sc', 'sc_eq13')">
                        </div>
                        <span>×</span>
                        <div class="var-input">
                            <label>K<sub>R</sub></label>
                            <input type="number" id="KR_eq13" step="any" oninput="syncInput('KR', 'KR_eq13')">
                        </div>
                        <span>× SF /</span>
                        <div class="var-input">
                            <label>Z<sub>N,G</sub></label>
                            <input type="number" id="ZNG_eq13" step="any" oninput="syncInput('ZNG', 'ZNG_eq13')">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Required Hardness (Grade 1 Steel)</h2>
                <div class="info-box">
                    Use largest HB from contact and bending formulas (Step 37)
                </div>
                <div class="equation-block">
                    <div class="equation-latex">$$HB_{contact} = \frac{\sigma_{ac,P}/1000 - 29.10}{0.322}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>HB<sub>contact</sub> =</label>
                            <input type="number" id="HB_contact_1" step="any" oninput="markAsUser('HB_contact_1'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(</span>
                        <div class="var-input">
                            <label>σ<sub>ac,P</sub></label>
                            <input type="number" id="sacP_eq14" step="any" oninput="syncInput('sacP', 'sacP_eq14')">
                        </div>
                        <span>/ 1000 - 29.10) / 0.322</span>
                    </div>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$$HB_{bending} = \frac{\sigma_{at,P}/1000 - 12.8}{0.0773}$$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>HB<sub>bending</sub> =</label>
                            <input type="number" id="HB_bending_1" step="any" oninput="markAsUser('HB_bending_1'); calculate()">
                        </div>
                        <span>=</span>
                        <span>(</span>
                        <div class="var-input">
                            <label>σ<sub>at,P</sub></label>
                            <input type="number" id="satP_eq15" step="any" oninput="syncInput('satP', 'satP_eq15')">
                        </div>
                        <span>/ 1000 - 12.8) / 0.0773</span>
                    </div>
                </div>
            </div>

            <div class="summary-section">
                <h2>Summary</h2>
                <p><strong>Design Power:</strong> <span id="sum_Pdes">-</span> hp</p>
                <p><strong>Pinion Diameter:</strong> <span id="sum_DP">-</span> in</p>
                <p><strong>Gear Diameter:</strong> <span id="sum_DG">-</span> in</p>
                <p><strong>Bending Stress Pinion:</strong> <span id="sum_stP">-</span> psi</p>
                <p><strong>Contact Stress:</strong> <span id="sum_sc">-</span> psi</p>
            </div>
            </div>
            <!-- End Procedure Tab -->

            <!-- General Equations Tab -->
            <div id="equations-tab" class="tab-content">
                <div class="info-box">
                    📐 Reference equations from Section 2.1.3 Formulae. These are general formulas you can use for calculations.
                </div>

                <div class="section">
                    <h2>Geometry Equations</h2>

                    <div class="equation-block">
                        <div class="equation-latex">$$p = \frac{\pi D_P}{N_P} = \frac{\pi D_G}{N_G} = \frac{\pi}{P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>p (in)</label>
                                <input type="number" id="p_eq" step="any" oninput="markAsUser('p_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>P</sub> (in)</label>
                                <input type="number" id="DP_eq" step="any" oninput="markAsUser('DP_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>P</sub></label>
                                <input type="number" id="NP_eq" step="1" oninput="markAsUser('NP_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>G</sub> (in)</label>
                                <input type="number" id="DG_eq" step="any" oninput="markAsUser('DG_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>G</sub></label>
                                <input type="number" id="NG_eq" step="1" oninput="markAsUser('NG_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq" step="any" oninput="markAsUser('Pd_eq'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Circular pitch</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$m = \frac{D_P}{N_P} = \frac{D_G}{N_G} = \frac{1}{P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>m (mm)</label>
                                <input type="number" id="m_eq" step="any" oninput="markAsUser('m_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>P</sub> (in)</label>
                                <input type="number" id="DP_eq2" step="any" oninput="markAsUser('DP_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>P</sub></label>
                                <input type="number" id="NP_eq2" step="1" oninput="markAsUser('NP_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq2" step="any" oninput="markAsUser('Pd_eq2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Module</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$m_G = \frac{N_G}{N_P}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>m<sub>G</sub></label>
                                <input type="number" id="mG_eq" step="any" oninput="markAsUser('mG_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>G</sub></label>
                                <input type="number" id="NG_eq2" step="1" oninput="markAsUser('NG_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>P</sub></label>
                                <input type="number" id="NP_eq3" step="1" oninput="markAsUser('NP_eq3'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear ratio</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$D_o = \frac{N + 2}{P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>D<sub>o</sub> (in)</label>
                                <input type="number" id="Do_eq" step="any" oninput="markAsUser('Do_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N</label>
                                <input type="number" id="N_eq" step="1" oninput="markAsUser('N_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq3" step="any" oninput="markAsUser('Pd_eq3'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Outside diameter</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$D_R = D - 2b$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>D<sub>R</sub> (in)</label>
                                <input type="number" id="DR_eq" step="any" oninput="markAsUser('DR_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D (in)</label>
                                <input type="number" id="D_eq" step="any" oninput="markAsUser('D_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>b (in)</label>
                                <input type="number" id="b_eq2" step="any" oninput="markAsUser('b_eq2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Root diameter</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$a = \frac{1}{P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>a (in)</label>
                                <input type="number" id="a_eq" step="any" oninput="markAsUser('a_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq4" step="any" oninput="markAsUser('Pd_eq4'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Addendum</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$b = \begin{cases} \frac{1.25}{P_d} & P_d < 20 \\ \frac{1.20}{P_d} + 0.002 & P_d \geq 20 \end{cases}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>b (in)</label>
                                <input type="number" id="b_eq" step="any" oninput="markAsUser('b_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq5" step="any" oninput="markAsUser('Pd_eq5'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Dedendum (piecewise)</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$c = \begin{cases} \frac{0.25}{P_d} & P_d < 20 \\ \frac{0.20}{P_d} + 0.002 & P_d \geq 20 \end{cases}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>c (in)</label>
                                <input type="number" id="c_eq" step="any" oninput="markAsUser('c_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq6" step="any" oninput="markAsUser('Pd_eq6'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Clearance (piecewise)</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$h_f = a + b$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>h<sub>f</sub> (in)</label>
                                <input type="number" id="hf_eq" step="any" oninput="markAsUser('hf_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>a (in)</label>
                                <input type="number" id="a_eq2" step="any" oninput="markAsUser('a_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>b (in)</label>
                                <input type="number" id="b_eq3" step="any" oninput="markAsUser('b_eq3'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Whole depth</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$h_k = 2a$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>h<sub>k</sub> (in)</label>
                                <input type="number" id="hk_eq" step="any" oninput="markAsUser('hk_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>a (in)</label>
                                <input type="number" id="a_eq3" step="any" oninput="markAsUser('a_eq3'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Working depth</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$t = \frac{p}{2} = \frac{\pi}{2P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>t (in)</label>
                                <input type="number" id="t_eq" step="any" oninput="markAsUser('t_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>p (in)</label>
                                <input type="number" id="p_eq2" step="any" oninput="markAsUser('p_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq7" step="any" oninput="markAsUser('Pd_eq7'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Tooth thickness</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$F_{nominal} = \frac{12}{P_d} \quad \left(\frac{8}{P_d} < F < \frac{16}{P_d}\right)$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>F (in)</label>
                                <input type="number" id="F_eq" step="any" oninput="markAsUser('F_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq8" step="any" oninput="markAsUser('Pd_eq8'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Face width (nominal)</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$C = \frac{D_P + D_G}{2} = \frac{N_P + N_G}{2P_d}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>C (in)</label>
                                <input type="number" id="C_eq" step="any" oninput="markAsUser('C_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>P</sub> (in)</label>
                                <input type="number" id="DP_eq3" step="any" oninput="markAsUser('DP_eq3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>D<sub>G</sub> (in)</label>
                                <input type="number" id="DG_eq2" step="any" oninput="markAsUser('DG_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>P</sub></label>
                                <input type="number" id="NP_eq4" step="1" oninput="markAsUser('NP_eq4'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>G</sub></label>
                                <input type="number" id="NG_eq3" step="1" oninput="markAsUser('NG_eq3'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq9" step="any" oninput="markAsUser('Pd_eq9'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Center distance</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$D_b = \frac{N_p}{P_d} \cos \phi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>D<sub>b</sub> (in)</label>
                                <input type="number" id="Db_eq" step="any" oninput="markAsUser('Db_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>N<sub>P</sub></label>
                                <input type="number" id="NP_eq5" step="1" oninput="markAsUser('NP_eq5'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>P<sub>d</sub> (teeth/in)</label>
                                <input type="number" id="Pd_eq10" step="any" oninput="markAsUser('Pd_eq10'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>φ (deg)</label>
                                <input type="number" id="phi_eq" step="any" oninput="markAsUser('phi_eq'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Base circle diameter</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Forces and Motion</h2>

                    <div class="equation-block">
                        <div class="equation-latex">$$F_{t,x-y} = W_t$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>F<sub>t</sub> (lbf)</label>
                                <input type="number" id="Ft_eq" step="any" oninput="markAsUser('Ft_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>W<sub>t</sub> (lbf)</label>
                                <input type="number" id="Wt_eq" step="any" oninput="markAsUser('Wt_eq'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Transmitted force</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$F_{r,x-y} = F_{t,x-y} \tan \phi$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>F<sub>r</sub> (lbf)</label>
                                <input type="number" id="Fr_eq" step="any" oninput="markAsUser('Fr_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>F<sub>t</sub> (lbf)</label>
                                <input type="number" id="Ft_eq2" step="any" oninput="markAsUser('Ft_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>φ (deg)</label>
                                <input type="number" id="phi_eq2" step="any" oninput="markAsUser('phi_eq2'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Radial force</p>
                    </div>

                    <div class="equation-block">
                        <div class="equation-latex">$$T = W_t \frac{d}{2}$$</div>
                        <div class="equation-inputs">
                            <div class="var-input">
                                <label>T (lbf·in)</label>
                                <input type="number" id="T_eq" step="any" oninput="markAsUser('T_eq'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>W<sub>t</sub> (lbf)</label>
                                <input type="number" id="Wt_eq2" step="any" oninput="markAsUser('Wt_eq2'); calculate()">
                            </div>
                            <div class="var-input">
                                <label>d (in)</label>
                                <input type="number" id="d_eq" step="any" oninput="markAsUser('d_eq'); calculate()">
                            </div>
                        </div>
                        <p style="margin-top:10px; color:#666; font-size:0.9em;">Torque</p>
                    </div>
                </div>
            </div>
            <!-- End General Equations Tab -->

            <!-- Variables Tab -->
            <div id="variables-tab" class="tab-content">
                <div class="info-box">
                    📝 Complete list of variables from Section 2.1.2 Nomenclature. Values sync with the calculator.
                </div>

                <table class="variables-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Description</th>
                            <th>Value</th>
                            <th>Unit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="var-category">
                            <td colspan="4">Basic Gear Parameters</td>
                        </tr>
                        <tr>
                            <td>N<sub>P</sub></td>
                            <td>Number of teeth on pinion (input)</td>
                            <td><input type="number" id="var_NP" step="1" oninput="syncVarInput('var_NP')"></td>
                            <td>teeth</td>
                        </tr>
                        <tr>
                            <td>N<sub>G</sub></td>
                            <td>Number of teeth on gear (output)</td>
                            <td><input type="number" id="var_NG" step="1" oninput="syncVarInput('var_NG')"></td>
                            <td>teeth</td>
                        </tr>
                        <tr>
                            <td>p</td>
                            <td>Circular pitch</td>
                            <td><input type="number" id="var_p" step="any" oninput="syncVarInput('var_p')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>P<sub>d</sub></td>
                            <td>Diametral pitch</td>
                            <td><input type="number" id="var_Pd" step="any" oninput="syncVarInput('var_Pd')"></td>
                            <td>teeth/in</td>
                        </tr>
                        <tr>
                            <td>m</td>
                            <td>Module</td>
                            <td><input type="number" id="var_m" step="any" oninput="syncVarInput('var_m')"></td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>D<sub>P</sub></td>
                            <td>Pitch diameter of pinion</td>
                            <td><input type="number" id="var_DP" step="any" oninput="syncVarInput('var_DP')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>D<sub>G</sub></td>
                            <td>Pitch diameter of gear</td>
                            <td><input type="number" id="var_DG" step="any" oninput="syncVarInput('var_DG')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>φ</td>
                            <td>Pressure angle</td>
                            <td><input type="number" id="var_phi" step="any" oninput="syncVarInput('var_phi')"></td>
                            <td>degrees</td>
                        </tr>
                        <tr>
                            <td>F</td>
                            <td>Face width</td>
                            <td><input type="number" id="var_F" step="any" oninput="syncVarInput('var_F')"></td>
                            <td>in</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Tooth Dimensions</td>
                        </tr>
                        <tr>
                            <td>a</td>
                            <td>Addendum</td>
                            <td><input type="number" id="var_a" step="any" oninput="syncVarInput('var_a')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>b</td>
                            <td>Dedendum</td>
                            <td><input type="number" id="var_b" step="any" oninput="syncVarInput('var_b')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>c</td>
                            <td>Clearance</td>
                            <td><input type="number" id="var_c" step="any" oninput="syncVarInput('var_c')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>h<sub>f</sub></td>
                            <td>Whole depth</td>
                            <td><input type="number" id="var_hf" step="any" oninput="syncVarInput('var_hf')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>h<sub>k</sub></td>
                            <td>Working depth</td>
                            <td><input type="number" id="var_hk" step="any" oninput="syncVarInput('var_hk')"></td>
                            <td>in</td>
                        </tr>
                        <tr>
                            <td>t</td>
                            <td>Tooth thickness</td>
                            <td><input type="number" id="var_t" step="any" oninput="syncVarInput('var_t')"></td>
                            <td>in</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Power and Motion</td>
                        </tr>
                        <tr>
                            <td>P</td>
                            <td>Transmitted power</td>
                            <td><input type="number" id="var_P" step="any" oninput="syncVarInput('var_P')"></td>
                            <td>hp</td>
                        </tr>
                        <tr>
                            <td>n<sub>P</sub></td>
                            <td>Pinion speed (input)</td>
                            <td><input type="number" id="var_nP" step="any" oninput="syncVarInput('var_nP')"></td>
                            <td>rpm</td>
                        </tr>
                        <tr>
                            <td>n<sub>G</sub></td>
                            <td>Gear speed (output)</td>
                            <td><input type="number" id="var_nG" step="any" oninput="syncVarInput('var_nG')"></td>
                            <td>rpm</td>
                        </tr>
                        <tr>
                            <td>v<sub>t</sub></td>
                            <td>Pitch-line velocity</td>
                            <td><input type="number" id="var_vt" step="any" oninput="syncVarInput('var_vt')"></td>
                            <td>ft/min</td>
                        </tr>
                        <tr>
                            <td>W<sub>t</sub></td>
                            <td>Transmitted load</td>
                            <td><input type="number" id="var_Wt" step="any" oninput="syncVarInput('var_Wt')"></td>
                            <td>lbf</td>
                        </tr>
                        <tr>
                            <td>W<sub>r</sub></td>
                            <td>Radial force</td>
                            <td><input type="number" id="var_Wr" step="any" oninput="syncVarInput('var_Wr')"></td>
                            <td>lbf</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Stress Analysis Factors</td>
                        </tr>
                        <tr>
                            <td>K<sub>O</sub></td>
                            <td>Overload Factor</td>
                            <td><input type="number" id="var_KO" step="any" oninput="syncVarInput('var_KO')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>K<sub>v</sub></td>
                            <td>Dynamic factor</td>
                            <td><input type="number" id="var_Kv" step="any" oninput="syncVarInput('var_Kv')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>K<sub>m</sub></td>
                            <td>Load-distribution factor</td>
                            <td><input type="number" id="var_Km" step="any" oninput="syncVarInput('var_Km')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>K<sub>s</sub></td>
                            <td>Size factor</td>
                            <td><input type="number" id="var_Ks" step="any" oninput="syncVarInput('var_Ks')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>K<sub>B</sub></td>
                            <td>Rim thickness factor</td>
                            <td><input type="number" id="var_KB" step="any" oninput="syncVarInput('var_KB')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>J<sub>P</sub></td>
                            <td>Bending geometry factor of the pinion</td>
                            <td><input type="number" id="var_JP" step="any" oninput="syncVarInput('var_JP')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>J<sub>G</sub></td>
                            <td>Bending geometry factor of the gear</td>
                            <td><input type="number" id="var_JG" step="any" oninput="syncVarInput('var_JG')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>I</td>
                            <td>Pitting geometry factor</td>
                            <td><input type="number" id="var_I" step="any" oninput="syncVarInput('var_I')"></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>C<sub>P</sub></td>
                            <td>Elastic coefficient</td>
                            <td><input type="number" id="var_CP" step="any" oninput="syncVarInput('var_CP')"></td>
                            <td>√psi</td>
                        </tr>

                        <tr class="var-category">
                            <td colspan="4">Stress Values</td>
                        </tr>
                        <tr>
                            <td>σ<sub>tP</sub></td>
                            <td>Expected bending stress in pinion</td>
                            <td><input type="number" id="var_stP" step="any" oninput="syncVarInput('var_stP')"></td>
                            <td>psi</td>
                        </tr>
                        <tr>
                            <td>σ<sub>tG</sub></td>
                            <td>Expected bending stress in gear</td>
                            <td><input type="number" id="var_stG" step="any" oninput="syncVarInput('var_stG')"></td>
                            <td>psi</td>
                        </tr>
                        <tr>
                            <td>σ<sub>c</sub></td>
                            <td>Expected contact stress</td>
                            <td><input type="number" id="var_sc" step="any" oninput="syncVarInput('var_sc')"></td>
                            <td>psi</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- End Variables Tab -->

        </div>
    </div>

    <script>
        const userValues = new Set();
        let crosshairsActive = false;
        let crosshairsFeatureEnabled = false;

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            const activeTab = document.getElementById(tabName + '-tab');
            activeTab.classList.add('active');
            event.currentTarget.classList.add('active');

            // Re-render MathJax for the new tab
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([activeTab]).catch((err) => console.log(err));
            }
        }

        // Map of all variable instances across all tabs
        const varInstanceMap = {
            'NP': ['NP', 'var_NP', 'NP_eq', 'NP_eq2', 'NP_eq3', 'NP_eq4', 'NP_eq5', 'NP_eq2'],
            'NG': ['NG', 'var_NG', 'NG_eq', 'NG_eq2', 'NG_eq3', 'NG_eq3'],
            'Pd': ['Pd', 'var_Pd', 'Pd_eq', 'Pd_eq2', 'Pd_eq3', 'Pd_eq4', 'Pd_eq5', 'Pd_eq6', 'Pd_eq7', 'Pd_eq8', 'Pd_eq9', 'Pd_eq10', 'Pd_eq2', 'Pd_eq3'],
            'DP': ['DP', 'var_DP', 'DP_eq', 'DP_eq2', 'DP_eq3', 'DP_eq4', 'DP_eq5'],
            'DG': ['DG', 'var_DG', 'DG_eq', 'DG_eq2', 'DG_eq4'],
            'p': ['p', 'var_p', 'p_eq', 'p_eq2'],
            'phi': ['phi', 'var_phi', 'phi_eq', 'phi_eq2'],
            'F': ['F', 'var_F', 'F_eq'],
            'P': ['P', 'var_P', 'P_eq', 'P_eq1', 'P_eq6'],
            'nP': ['nP', 'var_nP', 'nP_eq', 'nP_eq5'],
            'nG': ['nG', 'var_nG', 'nG_eq'],
            'vt': ['vt', 'var_vt', 'vt_eq', 'vt_eq6'],
            'Wt': ['Wt', 'var_Wt', 'Wt_eq', 'Wt_eq2'],
            'Wr': ['Wr', 'var_Wr', 'Wr_eq'],
            'Ft': ['Ft', 'Ft_eq', 'Ft_eq2'],
            'Fr': ['Fr', 'Fr_eq'],
            'KO': ['KO', 'var_KO', 'KO_eq', 'KO_eq1'],
            'Kv': ['Kv', 'var_Kv', 'Kv_eq'],
            'Km': ['Km', 'var_Km', 'Km_eq'],
            'Ks': ['Ks', 'var_Ks', 'Ks_eq'],
            'KB': ['KB', 'var_KB', 'KB_eq'],
            'JP': ['JP', 'var_JP', 'JP_eq', 'JP_eq8'],
            'JG': ['JG', 'var_JG', 'JG_eq', 'JG_eq8'],
            'I': ['I', 'var_I', 'I_eq'],
            'CP': ['CP', 'var_CP', 'CP_eq'],
            'stP': ['stP', 'var_stP', 'stP_eq', 'stP_eq8', 'stP_eq10'],
            'stG': ['stG', 'var_stG', 'stG_eq', 'stG_eq11'],
            'sc': ['sc', 'var_sc', 'sc_eq', 'sc_eq12', 'sc_eq13'],
            'KR': ['KR', 'KR_eq10', 'KR_eq11', 'KR_eq12', 'KR_eq13'],
            'YNP': ['YNP', 'YNP_eq10'],
            'YNG': ['YNG', 'YNG_eq11'],
            'ZNP': ['ZNP', 'ZNP_eq12'],
            'ZNG': ['ZNG', 'ZNG_eq13'],
            'sacP': ['sacP', 'sacP_eq14'],
            'satP': ['satP', 'satP_eq15'],
            'a': ['a', 'var_a', 'a_eq', 'a_eq2', 'a_eq3'],
            'b': ['b', 'var_b', 'b_eq', 'b_eq2', 'b_eq3'],
            'c': ['c', 'var_c', 'c_eq'],
            'hf': ['hf', 'var_hf', 'hf_eq'],
            'hk': ['hk', 'var_hk', 'hk_eq'],
            't': ['t', 'var_t', 't_eq'],
            'C': ['C', 'var_C', 'C_eq'],
            'Db': ['Db', 'Db_eq'],
            'DR': ['DR', 'DR_eq'],
            'Do': ['Do', 'Do_eq'],
            'D': ['D', 'D_eq'],
            'N': ['N', 'N_eq'],
            'd': ['d', 'd_eq'],
            'T': ['T', 'T_eq'],
            'm': ['m', 'var_m', 'm_eq'],
            'mG': ['mG', 'var_mG', 'mG_eq'],
            'Pdes': ['Pdes'],
            'SF': ['SF'],
            'satG': ['satG'],
            'sacG': ['sacG'],
            'HB_contact_1': ['HB_contact_1'],
            'HB_bending_1': ['HB_bending_1'],
            'Av': ['Av']
        };

        // Get base variable name from any instance ID
        function getBaseVarName(id) {
            // Check if id starts with 'var_'
            if (id.startsWith('var_')) {
                return id.substring(4);
            }
            // Match IDs like 'NP_eq', 'NP_eq2', 'Pd_eq10', etc.
            const eqMatch = id.match(/^(.+)_eq\d*$/);
            if (eqMatch) {
                return eqMatch[1];
            }
            // Otherwise it's the base name
            return id;
        }

        // Sync a value across all instances of a variable
        function syncAllInstances(sourceId) {
            const baseVar = getBaseVarName(sourceId);
            const sourceEl = document.getElementById(sourceId);

            if (!sourceEl || !varInstanceMap[baseVar]) return;

            const value = sourceEl.value;

            // Update all instances of this variable
            varInstanceMap[baseVar].forEach(instanceId => {
                if (instanceId !== sourceId) {
                    const el = document.getElementById(instanceId);
                    if (el) {
                        el.value = value;
                    }
                }
            });
        }

        function markAsUser(varId) {
            userValues.add(varId);
            syncAllInstances(varId);
        }

        function syncInput(mainId, sourceId) {
            const sourceEl = document.getElementById(sourceId);
            const mainEl = document.getElementById(mainId);
            if (sourceEl && mainEl) {
                mainEl.value = sourceEl.value;
            }
            markAsUser(mainId);
            calculate();
        }

        function syncVarInput(varId) {
            markAsUser(varId);
            calculate();
        }

        function getValue(id) {
            const el = document.getElementById(id);
            if (!el) return null;
            const val = parseFloat(el.value);
            return isNaN(val) ? null : val;
        }

        function setValue(id, value) {
            if (value !== null && !isNaN(value)) {
                const el = document.getElementById(id);
                if (el) {
                    el.value = value.toFixed(4);
                    if (!userValues.has(id)) {
                        el.classList.add('computed');
                    }
                }
                // Sync to all instances
                syncAllInstances(id);
                const sumEl = document.getElementById('sum_' + id);
                if (sumEl) sumEl.textContent = value.toFixed(4);
            }
        }

        function syncAllFields() {
            // This function is now handled by syncAllInstances automatically
            // Kept for compatibility
        }

        function calculate() {
            syncAllFields();

            const P = getValue('P');
            const KO = getValue('KO');
            const Pd = getValue('Pd');
            const NP = getValue('NP');
            const NG = getValue('NG');
            const nP = getValue('nP');
            const F = getValue('F');
            const Kv = getValue('Kv');
            const JP = getValue('JP');
            const JG = getValue('JG');
            const I = getValue('I');
            const Km = getValue('Km');
            const Ks = getValue('Ks');
            const KB = getValue('KB');
            const CP = getValue('CP');
            const SF = getValue('SF');
            const KR = getValue('KR');
            const YNP = getValue('YNP');
            const YNG = getValue('YNG');
            const ZNP = getValue('ZNP');
            const ZNG = getValue('ZNG');

            // Design power
            if (P && KO && !userValues.has('Pdes')) {
                setValue('Pdes', P * KO);
            }

            // Diameters
            if (NP && Pd && !userValues.has('DP')) {
                setValue('DP', NP / Pd);
            }
            if (NG && Pd && !userValues.has('DG')) {
                setValue('DG', NG / Pd);
            }

            const DP = getValue('DP');
            const DG = getValue('DG');

            // Center distance
            if (DP && DG && !userValues.has('C')) {
                setValue('C', (DP + DG) / 2);
            }

            // Pitch line velocity
            if (DP && nP && !userValues.has('vt')) {
                setValue('vt', Math.PI * DP * nP / 12);
            }

            const vt = getValue('vt');

            // Transmitted load
            if (P && vt && !userValues.has('Wt')) {
                setValue('Wt', 33000 * P / vt);
            }

            const Wt = getValue('Wt');

            // Bending stress
            if (Wt && Pd && F && JP && KO && Ks && Km && KB && Kv && !userValues.has('stP')) {
                const stP = (Wt * Pd / (F * JP)) * KO * Ks * Km * KB * Kv;
                setValue('stP', stP);
            }

            const stP = getValue('stP');

            if (stP && JP && JG && !userValues.has('stG')) {
                const stG = stP * JP / JG;
                setValue('stG', stG);
            }

            // Contact stress
            if (Wt && KO && Ks && Km && Kv && F && DP && I && CP && !userValues.has('sc')) {
                const sc = CP * Math.sqrt((Wt * KO * Ks * Km * Kv) / (F * DP * I));
                setValue('sc', sc);
            }

            const stG = getValue('stG');
            const sc = getValue('sc');

            // Required strengths
            if (stP && KR && SF && YNP && !userValues.has('satP')) {
                setValue('satP', stP * KR * SF / YNP);
            }
            if (stG && KR && SF && YNG && !userValues.has('satG')) {
                setValue('satG', stG * KR * SF / YNG);
            }
            if (sc && KR && SF && ZNP && !userValues.has('sacP')) {
                setValue('sacP', sc * KR * SF / ZNP);
            }
            if (sc && KR && SF && ZNG && !userValues.has('sacG')) {
                setValue('sacG', sc * KR * SF / ZNG);
            }

            const sacP = getValue('sacP');
            const satP = getValue('satP');

            // Required hardness
            if (sacP && !userValues.has('HB_contact_1')) {
                const HB_c1 = (sacP / 1000 - 29.10) / 0.322;
                setValue('HB_contact_1', HB_c1);
            }
            if (satP && !userValues.has('HB_bending_1')) {
                const HB_b1 = (satP / 1000 - 12.8) / 0.0773;
                setValue('HB_bending_1', HB_b1);
            }

            saveSession();
        }

        function saveSession() {
            const state = {};
            document.querySelectorAll('input[type="number"]').forEach(input => {
                if (input.value) state[input.id] = input.value;
            });
            state.userValues = Array.from(userValues);
            localStorage.setItem('fizz_spur_state', JSON.stringify(state));
        }

        function loadSession() {
            const saved = localStorage.getItem('fizz_spur_state');
            if (saved) {
                const state = JSON.parse(saved);
                userValues.clear();
                if (state.userValues) state.userValues.forEach(v => userValues.add(v));
                for (let key in state) {
                    const el = document.getElementById(key);
                    if (el && state[key]) {
                        el.value = state[key];
                        if (el.tagName === 'INPUT' && el.type === 'number') {
                            if (userValues.has(key)) {
                                el.classList.remove('computed');
                            } else {
                                el.classList.add('computed');
                            }
                        }
                    }
                }
                calculate();
            }
        }

        function saveSessionManual() {
            saveSession();
            alert('Session saved successfully! ✓');
        }

        function resetAll() {
            if (confirm('Reset all values?')) {
                localStorage.removeItem('fizz_spur_state');
                userValues.clear();
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.value = '';
                    input.classList.remove('computed');
                });
                document.querySelectorAll('.summary-section span').forEach(span => {
                    span.textContent = '-';
                });
            }
        }

        // Initialize crosshairs functionality
        function initCrosshairs() {
            const pdfContainer = document.querySelector('.pdf-container');
            const clickOverlay = document.getElementById('click-overlay');
            const svg = document.getElementById('pdf-crosshairs');
            const verticalLine = document.getElementById('crosshair-vertical');
            const horizontalLine = document.getElementById('crosshair-horizontal');

            if (!pdfContainer || !clickOverlay || !svg || !verticalLine || !horizontalLine) return;

            // Start with overlay hidden (PDF fully interactive by default)
            clickOverlay.style.display = 'none';

            // Listen for clicks on the click overlay - toggle crosshairs on/off
            clickOverlay.addEventListener('click', function(e) {
                if (!crosshairsActive) {
                    // SHOW CROSSHAIRS
                    const rect = pdfContainer.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    verticalLine.setAttribute('x1', x);
                    verticalLine.setAttribute('x2', x);
                    verticalLine.setAttribute('y2', rect.height);

                    horizontalLine.setAttribute('y1', y);
                    horizontalLine.setAttribute('y2', y);
                    horizontalLine.setAttribute('x2', rect.width);

                    verticalLine.classList.add('active');
                    horizontalLine.classList.add('active');
                    crosshairsActive = true;
                } else {
                    // HIDE CROSSHAIRS
                    verticalLine.classList.remove('active');
                    horizontalLine.classList.remove('active');
                    crosshairsActive = false;
                }
            });
        }

        // Toggle crosshairs feature on/off
        function toggleCrosshairsFeature() {
            const clickOverlay = document.getElementById('click-overlay');
            const toggleBtn = document.getElementById('toggle-crosshairs-btn');
            const verticalLine = document.getElementById('crosshair-vertical');
            const horizontalLine = document.getElementById('crosshair-horizontal');

            if (!clickOverlay || !toggleBtn) return;

            crosshairsFeatureEnabled = !crosshairsFeatureEnabled;

            if (crosshairsFeatureEnabled) {
                // ENABLE CROSSHAIRS FEATURE
                clickOverlay.style.display = 'block';
                toggleBtn.textContent = '🎯 Disable Crosshairs';
                toggleBtn.classList.add('active');
            } else {
                // DISABLE CROSSHAIRS FEATURE
                clickOverlay.style.display = 'none';
                toggleBtn.textContent = '🎯 Enable Crosshairs';
                toggleBtn.classList.remove('active');

                // Also hide any active crosshairs
                if (crosshairsActive) {
                    verticalLine.classList.remove('active');
                    horizontalLine.classList.remove('active');
                    crosshairsActive = false;
                }
            }
        }

        // PDF Page Navigation
        function goToPage(page) {
            const embed = document.getElementById("pdf");
            const currSrc = embed.src.split('#')[0];

            // Force complete reload by clearing and resetting with delay
            embed.src = '';
            setTimeout(() => {
                embed.src = `${currSrc}#page=${page}`;
            }, 50);
        }

        window.addEventListener('DOMContentLoaded', () => {
            initCrosshairs();
            loadSession();
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise();
            }
        });
    </script>
</body>
</html>
