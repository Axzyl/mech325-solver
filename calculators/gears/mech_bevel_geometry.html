<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bevel Gear Spec Calculator</title>

    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        #pdf-panel {
            flex: 1;
            background: #fff;
            border-right: 2px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        /* PDF Container with Crosshairs Support */
        .pdf-container {
            position: relative;
            width: 100%;
            height: 100%;
            flex: 1;
            display: flex;
        }
        .pdf-container embed {
            flex: 1;
            width: 100%;
            height: 100%;
        }

        /* PDF Crosshairs Feature */
        .click-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            cursor: crosshair;
        }

        .crosshairs-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .crosshair-line {
            stroke: #ff0000;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .crosshair-line.active {
            opacity: 0.8;
        }

        #calculator-panel {
            flex: 1;
            background: #fff;
            overflow-y: auto;
            padding: 20px 40px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #7f8c8d;
            font-style: italic;
            margin-bottom: 20px;
        }

        /* Button Group */
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 100;
            padding: 15px 0;
            margin-top: -15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .save-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .save-btn:hover {
            background: #218838;
        }

        .reset-btn {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .reset-btn:hover {
            background: #c82333;
        }

        .toggle-crosshairs-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .toggle-crosshairs-btn:hover {
            background: #5a6268;
        }

        .toggle-crosshairs-btn.active {
            background: #28a745;
        }

        .toggle-crosshairs-btn.active:hover {
            background: #218838;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #3498db;
        }

        .section h3 {
            color: #34495e;
            font-size: 16px;
            margin-bottom: 10px;
            margin-top: 15px;
        }

        .pitch-info {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #2196f3;
            margin-bottom: 10px;
            font-weight: bold;
            color: #1976d2;
        }

        .warning-box {
            background: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin-top: 10px;
            color: #856404;
            display: none;
        }

        .info-box {
            background: #e7f3ff;
            padding: 10px;
            border-left: 4px solid #2196f3;
            margin-bottom: 10px;
            font-size: 14px;
        }

        /* PDF navigation link styling */
        .warning-box a,
        .info-box a {
            color: #0066cc;
            text-decoration: underline;
            font-weight: 600;
            cursor: pointer;
        }

        .warning-box a:hover,
        .info-box a:hover {
            color: #004499;
        }

        .equation-block {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .equation-latex {
            margin-bottom: 12px;
            font-size: 16px;
        }

        .equation-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .var-input {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .var-input label {
            font-weight: 600;
            color: #2c3e50;
        }

        .var-input input {
            width: 100px;
            padding: 6px 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .var-input input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .var-input input.computed {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .var-input .unit {
            color: #7f8c8d;
            font-size: 13px;
        }

        .divider {
            height: 1px;
            background: #ddd;
            margin: 20px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 4px;
            border-left: 4px solid #28a745;
            margin-top: 20px;
        }

        .given-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .hint {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 5px;
        }

        /* Tab System */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            border-radius: 6px 6px 0 0;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: #e0e0e0;
        }

        .tab-button.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none !important;
        }

        .tab-content.active {
            display: block !important;
        }

        /* Variables Tab */
        .variables-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .variables-table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .variables-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
        }

        .variables-table tr:hover {
            background: #f8f9fa;
        }

        .variables-table input {
            width: 120px;
            padding: 6px 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
        }

        .var-category {
            background: #ecf0f1;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <!-- PDF Panel -->
    <div id="pdf-panel">
        <div class="pdf-container">
            <embed src="../../documents/gears/bevel_design_spec.pdf" type="application/pdf" id="pdf">
            <div class="click-overlay" id="click-overlay"></div>
            <svg id="pdf-crosshairs" class="crosshairs-overlay">
                <line id="crosshair-vertical" class="crosshair-line" x1="0" y1="0" x2="0" y2="100%" />
                <line id="crosshair-horizontal" class="crosshair-line" x1="0" y1="0" x2="100%" y2="0" />
            </svg>
        </div>
    </div>

    <!-- Calculator Panel -->
    <div id="calculator-panel">
        <h1>⚙️ Bevel Gear Spec Calculator</h1>
        <p class="subtitle">Based on Mott's design specification for bevel gears</p>

        <!-- Button Group -->
        <div class="button-group">
            <button class="save-btn" onclick="saveSession()">💾 Save Session</button>
            <button class="reset-btn" onclick="resetAll()">🔄 Reset All</button>
            <button class="toggle-crosshairs-btn" id="toggle-crosshairs-btn" onclick="toggleCrosshairsFeature()">🎯 Enable Crosshairs</button>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('procedure')">Procedure</button>
            <button class="tab-button" onclick="showTab('equations')">General Equations</button>
            <button class="tab-button" onclick="showTab('variables')">Variables</button>
        </div>

        <!-- Procedure Tab -->
        <div id="procedure-tab" class="tab-content active">

        <!-- Given Information -->
        <div class="section">
            <h2>Given Information</h2>
            <p style="margin-bottom: 10px;">Enter your known values below (you can edit any calculated value to override it):</p>

            <div class="given-inputs">
                <div class="var-input">
                    <label>P<sub>d</sub> =</label>
                    <input type="number" id="Pd" step="0.0001" oninput="markAsUser('Pd'); calculate()">
                    <span class="unit">teeth/in</span>
                </div>

                <div class="var-input">
                    <label>φ =</label>
                    <input type="number" id="phi" step="0.01" oninput="markAsUser('phi'); calculate()">
                    <span class="unit">deg</span>
                </div>

                <div class="var-input">
                    <label>N<sub>P</sub> =</label>
                    <input type="number" id="NP" step="1" oninput="markAsUser('NP'); calculate()">
                    <span class="unit">(teeth - pinion)</span>
                </div>

                <div class="var-input">
                    <label>N<sub>G</sub> =</label>
                    <input type="number" id="NG" step="1" oninput="markAsUser('NG'); calculate()">
                    <span class="unit">(teeth - gear)</span>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Calculations -->
        <div class="section">
            <h2>Calculations</h2>
            <p class="hint">Green background = calculated value. You can override any value by editing it.</p>

            <!-- Step 1: Gear Ratio and Pitch Diameters -->
            <h3>Step 1: Calculate Gear Ratio and Pitch Diameters</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$m_G = \frac{N_G}{N_P}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>m<sub>G</sub> =</label>
                        <input type="number" id="mG" step="0.0001" oninput="markAsUser('mG'); calculate()">
                        <span class="unit">(ratio)</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>N<sub>G</sub> =</label>
                        <input type="number" id="NG_eq1" step="1" oninput="syncInput('NG', 'NG_eq1'); calculate()">
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>N<sub>P</sub> =</label>
                        <input type="number" id="NP_eq1" step="1" oninput="syncInput('NP', 'NP_eq1'); calculate()">
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$D = \frac{N_G}{P_d}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>D =</label>
                        <input type="number" id="D" step="0.0001" oninput="markAsUser('D'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>N<sub>G</sub> =</label>
                        <input type="number" id="NG_eq2" step="1" oninput="syncInput('NG', 'NG_eq2'); calculate()">
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>P<sub>d</sub> =</label>
                        <input type="number" id="Pd_eq1" step="0.0001" oninput="syncInput('Pd', 'Pd_eq1'); calculate()">
                        <span class="unit">teeth/in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$d = \frac{N_P}{P_d}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>d =</label>
                        <input type="number" id="d" step="0.0001" oninput="markAsUser('d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>N<sub>P</sub> =</label>
                        <input type="number" id="NP_eq2" step="1" oninput="syncInput('NP', 'NP_eq2'); calculate()">
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>P<sub>d</sub> =</label>
                        <input type="number" id="Pd_eq2" step="0.0001" oninput="syncInput('Pd', 'Pd_eq2'); calculate()">
                        <span class="unit">teeth/in</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 2: Pitch Cone Angles -->
            <h3>Step 2: Calculate Pitch Cone Angles</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$\gamma = \tan^{-1}\left(\frac{N_P}{N_G}\right)$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>γ =</label>
                        <input type="number" id="gamma" step="0.0001" oninput="markAsUser('gamma'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>= atan(</span>
                    <div class="var-input">
                        <label>N<sub>P</sub> =</label>
                        <input type="number" id="NP_eq3" step="1" oninput="syncInput('NP', 'NP_eq3'); calculate()">
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>N<sub>G</sub> =</label>
                        <input type="number" id="NG_eq3" step="1" oninput="syncInput('NG', 'NG_eq3'); calculate()">
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$\Gamma = \tan^{-1}\left(\frac{N_G}{N_P}\right)$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>Γ =</label>
                        <input type="number" id="Gamma" step="0.0001" oninput="markAsUser('Gamma'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>= atan(</span>
                    <div class="var-input">
                        <label>N<sub>G</sub> =</label>
                        <input type="number" id="NG_eq4" step="1" oninput="syncInput('NG', 'NG_eq4'); calculate()">
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>N<sub>P</sub> =</label>
                        <input type="number" id="NP_eq4" step="1" oninput="syncInput('NP', 'NP_eq4'); calculate()">
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 3: Cone Distance -->
            <h3>Step 3: Calculate Cone Distance</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$A_O = \frac{0.5 D}{\sin(\Gamma)}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO" step="0.0001" oninput="markAsUser('AO'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>= (0.5 ×</span>
                    <div class="var-input">
                        <label>D =</label>
                        <input type="number" id="D_eq3" step="0.0001" oninput="syncInput('D', 'D_eq3'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>) / sin(</span>
                    <div class="var-input">
                        <label>Γ =</label>
                        <input type="number" id="Gamma_eq3" step="0.0001" oninput="syncInput('Gamma', 'Gamma_eq3'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 4: Face Width (SPECIAL - RANGE) -->
            <h3>Step 4: Determine Face Width Range</h3>

            <div class="info-box">
                ⚠️ <strong>Face width (F) is a recommended range, not a single value.</strong><br>
                F should satisfy: <strong>F<sub>nom</sub> ≤ F ≤ F<sub>max</sub></strong>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$F_{nom} = \frac{A_O}{3}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>F<sub>nom</sub> =</label>
                        <input type="number" id="Fnom" step="0.0001" oninput="markAsUser('Fnom'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO_eq4a" step="0.0001" oninput="syncInput('AO', 'AO_eq4a'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/ 3</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$F_{max} = \frac{10}{P_d}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>F<sub>max</sub> =</label>
                        <input type="number" id="Fmax" step="0.0001" oninput="markAsUser('Fmax'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>= 10 /</span>
                    <div class="var-input">
                        <label>P<sub>d</sub> =</label>
                        <input type="number" id="Pd_eq4" step="0.0001" oninput="syncInput('Pd', 'Pd_eq4'); calculate()">
                        <span class="unit">teeth/in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$F_{nom} \leq F \leq F_{max}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>F =</label>
                        <input type="number" id="F" step="0.0001" oninput="markAsUser('F'); validateFaceWidth(); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span class="hint">(Choose F within recommended range)</span>
                </div>
            </div>

            <div class="warning-box" id="F-warning"></div>

            <div class="divider"></div>

            <!-- Step 5: Mean Cone Distance -->
            <h3>Step 5: Calculate Mean Cone Distance</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$A_m = A_O - \frac{F}{2}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>A<sub>m</sub> =</label>
                        <input type="number" id="Am" step="0.0001" oninput="markAsUser('Am'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO_eq5" step="0.0001" oninput="syncInput('AO', 'AO_eq5'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>- (</span>
                    <div class="var-input">
                        <label>F =</label>
                        <input type="number" id="F_eq5" step="0.0001" oninput="syncInput('F', 'F_eq5'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/ 2)</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 6: Mean Circular Pitch -->
            <h3>Step 6: Calculate Mean Circular Pitch</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$p_m = \frac{\pi A_m}{0.5 N_G}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>p<sub>m</sub> =</label>
                        <input type="number" id="pm" step="0.0001" oninput="markAsUser('pm'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>= (π ×</span>
                    <div class="var-input">
                        <label>A<sub>m</sub> =</label>
                        <input type="number" id="Am_eq6" step="0.0001" oninput="syncInput('Am', 'Am_eq6'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>) / (0.5 ×</span>
                    <div class="var-input">
                        <label>N<sub>G</sub> =</label>
                        <input type="number" id="NG_eq6" step="1" oninput="syncInput('NG', 'NG_eq6'); calculate()">
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 7: Whole Depth and Clearance -->
            <h3>Step 7: Calculate Whole Depth and Clearance</h3>
            <div id="pitch-type-indicator"></div>

            <div class="equation-block">
                <div class="equation-latex" id="h-equation-latex">
                    $$h = \frac{2.188}{P_d}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>h =</label>
                        <input type="number" id="h" step="0.0001" oninput="markAsUser('h'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span id="h-formula-text">= 2.188 /</span>
                    <div class="var-input">
                        <label>P<sub>d</sub> =</label>
                        <input type="number" id="Pd_eq7" step="0.0001" oninput="syncInput('Pd', 'Pd_eq7'); calculate()">
                        <span class="unit">teeth/in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex" id="c-equation-latex">
                    $$c = \frac{0.188}{P_d}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>c =</label>
                        <input type="number" id="c" step="0.0001" oninput="markAsUser('c'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span id="c-formula-text">= 0.188 /</span>
                    <div class="var-input">
                        <label>P<sub>d</sub> =</label>
                        <input type="number" id="Pd_eq7b" step="0.0001" oninput="syncInput('Pd', 'Pd_eq7b'); calculate()">
                        <span class="unit">teeth/in</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 8: Mean Addendum and Dedendum -->
            <h3>Step 8: Calculate Mean Addendum and Dedendum</h3>

            <div class="equation-block">
                <div class="equation-latex" id="hm-equation-latex">
                    $$h_m = h \cos(\Gamma) - \frac{c}{2}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>h<sub>m</sub> =</label>
                        <input type="number" id="hm" step="0.0001" oninput="markAsUser('hm'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>h =</label>
                        <input type="number" id="h_eq8" step="0.0001" oninput="syncInput('h', 'h_eq8'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>× cos(</span>
                    <div class="var-input">
                        <label>Γ =</label>
                        <input type="number" id="Gamma_eq8" step="0.0001" oninput="syncInput('Gamma', 'Gamma_eq8'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span id="hm-formula-text">) - (</span>
                    <div class="var-input">
                        <label>c =</label>
                        <input type="number" id="c_eq8" step="0.0001" oninput="syncInput('c', 'c_eq8'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span id="hm-formula-text2">/ 2)</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex" id="c1-equation-latex">
                    $$c_1 = \frac{c}{2}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>c<sub>1</sub> =</label>
                        <input type="number" id="c1" step="0.0001" oninput="markAsUser('c1'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span id="c1-formula-text">=</span>
                    <div class="var-input">
                        <label>c =</label>
                        <input type="number" id="c_eq8b" step="0.0001" oninput="syncInput('c', 'c_eq8b'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span id="c1-formula-text2">/ 2</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$a_m = \frac{h_m}{2}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>a<sub>m</sub> =</label>
                        <input type="number" id="am" step="0.0001" oninput="markAsUser('am'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>h<sub>m</sub> =</label>
                        <input type="number" id="hm_eq8c" step="0.0001" oninput="syncInput('hm', 'hm_eq8c'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/ 2</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$b_m = h_m - a_m$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>b<sub>m</sub> =</label>
                        <input type="number" id="bm" step="0.0001" oninput="markAsUser('bm'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>h<sub>m</sub> =</label>
                        <input type="number" id="hm_eq8d" step="0.0001" oninput="syncInput('hm', 'hm_eq8d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>-</span>
                    <div class="var-input">
                        <label>a<sub>m</sub> =</label>
                        <input type="number" id="am_eq8d" step="0.0001" oninput="syncInput('am', 'am_eq8d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 9: Addendum and Dedendum Angles -->
            <h3>Step 9: Calculate Addendum and Dedendum Angles</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$a_G = \frac{a_m}{A_O}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>a<sub>G</sub> =</label>
                        <input type="number" id="aG" step="0.0001" oninput="markAsUser('aG'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>a<sub>m</sub> =</label>
                        <input type="number" id="am_eq9a" step="0.0001" oninput="syncInput('am', 'am_eq9a'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO_eq9a" step="0.0001" oninput="syncInput('AO', 'AO_eq9a'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$a_P = \frac{a_m}{A_O}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>a<sub>P</sub> =</label>
                        <input type="number" id="aP" step="0.0001" oninput="markAsUser('aP'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>a<sub>m</sub> =</label>
                        <input type="number" id="am_eq9b" step="0.0001" oninput="syncInput('am', 'am_eq9b'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO_eq9b" step="0.0001" oninput="syncInput('AO', 'AO_eq9b'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$b_G = \frac{b_m}{A_O}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>b<sub>G</sub> =</label>
                        <input type="number" id="bG" step="0.0001" oninput="markAsUser('bG'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>b<sub>m</sub> =</label>
                        <input type="number" id="bm_eq9c" step="0.0001" oninput="syncInput('bm', 'bm_eq9c'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO_eq9c" step="0.0001" oninput="syncInput('AO', 'AO_eq9c'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$b_P = \frac{b_m}{A_O}$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>b<sub>P</sub> =</label>
                        <input type="number" id="bP" step="0.0001" oninput="markAsUser('bP'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>b<sub>m</sub> =</label>
                        <input type="number" id="bm_eq9d" step="0.0001" oninput="syncInput('bm', 'bm_eq9d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/</span>
                    <div class="var-input">
                        <label>A<sub>O</sub> =</label>
                        <input type="number" id="AO_eq9d" step="0.0001" oninput="syncInput('AO', 'AO_eq9d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Step 10: Face Angles and Outside Diameters -->
            <h3>Step 10: Calculate Face Angles and Outside Diameters</h3>

            <div class="equation-block">
                <div class="equation-latex">
                    $$\delta_G = \Gamma + a_G$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>δ<sub>G</sub> =</label>
                        <input type="number" id="deltaG" step="0.0001" oninput="markAsUser('deltaG'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>Γ =</label>
                        <input type="number" id="Gamma_eq10a" step="0.0001" oninput="syncInput('Gamma', 'Gamma_eq10a'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>+</span>
                    <div class="var-input">
                        <label>a<sub>G</sub> =</label>
                        <input type="number" id="aG_eq10a" step="0.0001" oninput="syncInput('aG', 'aG_eq10a'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$\delta_P = \gamma + a_P$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>δ<sub>P</sub> =</label>
                        <input type="number" id="deltaP" step="0.0001" oninput="markAsUser('deltaP'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>γ =</label>
                        <input type="number" id="gamma_eq10b" step="0.0001" oninput="syncInput('gamma', 'gamma_eq10b'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>+</span>
                    <div class="var-input">
                        <label>a<sub>P</sub> =</label>
                        <input type="number" id="aP_eq10b" step="0.0001" oninput="syncInput('aP', 'aP_eq10b'); calculate()">
                        <span class="unit">in</span>
                    </div>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$a_{OG} = a_m + \frac{F}{2} \sin(\delta_G)$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>a<sub>OG</sub> =</label>
                        <input type="number" id="aOG" step="0.0001" oninput="markAsUser('aOG'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>a<sub>m</sub> =</label>
                        <input type="number" id="am_eq10c" step="0.0001" oninput="syncInput('am', 'am_eq10c'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>+ (</span>
                    <div class="var-input">
                        <label>F =</label>
                        <input type="number" id="F_eq10c" step="0.0001" oninput="syncInput('F', 'F_eq10c'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/ 2) × sin(</span>
                    <div class="var-input">
                        <label>δ<sub>G</sub> =</label>
                        <input type="number" id="deltaG_eq10c" step="0.0001" oninput="syncInput('deltaG', 'deltaG_eq10c'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$a_{OP} = a_m + \frac{F}{2} \sin(\delta_P)$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>a<sub>OP</sub> =</label>
                        <input type="number" id="aOP" step="0.0001" oninput="markAsUser('aOP'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>a<sub>m</sub> =</label>
                        <input type="number" id="am_eq10d" step="0.0001" oninput="syncInput('am', 'am_eq10d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>+ (</span>
                    <div class="var-input">
                        <label>F =</label>
                        <input type="number" id="F_eq10d" step="0.0001" oninput="syncInput('F', 'F_eq10d'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>/ 2) × sin(</span>
                    <div class="var-input">
                        <label>δ<sub>P</sub> =</label>
                        <input type="number" id="deltaP_eq10d" step="0.0001" oninput="syncInput('deltaP', 'deltaP_eq10d'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$D_O = D + 2 a_{OG} \cos(\Gamma)$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>D<sub>O</sub> =</label>
                        <input type="number" id="DO" step="0.0001" oninput="markAsUser('DO'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>D =</label>
                        <input type="number" id="D_eq10e" step="0.0001" oninput="syncInput('D', 'D_eq10e'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>+ 2 ×</span>
                    <div class="var-input">
                        <label>a<sub>OG</sub> =</label>
                        <input type="number" id="aOG_eq10e" step="0.0001" oninput="syncInput('aOG', 'aOG_eq10e'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>× cos(</span>
                    <div class="var-input">
                        <label>Γ =</label>
                        <input type="number" id="Gamma_eq10e" step="0.0001" oninput="syncInput('Gamma', 'Gamma_eq10e'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="equation-block">
                <div class="equation-latex">
                    $$d_O = d + 2 a_{OP} \cos(\gamma)$$
                </div>
                <div class="equation-inputs">
                    <div class="var-input">
                        <label>d<sub>O</sub> =</label>
                        <input type="number" id="dO" step="0.0001" oninput="markAsUser('dO'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>=</span>
                    <div class="var-input">
                        <label>d =</label>
                        <input type="number" id="d_eq10f" step="0.0001" oninput="syncInput('d', 'd_eq10f'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>+ 2 ×</span>
                    <div class="var-input">
                        <label>a<sub>OP</sub> =</label>
                        <input type="number" id="aOP_eq10f" step="0.0001" oninput="syncInput('aOP', 'aOP_eq10f'); calculate()">
                        <span class="unit">in</span>
                    </div>
                    <span>× cos(</span>
                    <div class="var-input">
                        <label>γ =</label>
                        <input type="number" id="gamma_eq10f" step="0.0001" oninput="syncInput('gamma', 'gamma_eq10f'); calculate()">
                        <span class="unit">deg</span>
                    </div>
                    <span>)</span>
                </div>
            </div>

            <div class="divider"></div>

            <div class="success">✅ You're done!</div>
        </div>

        </div> <!-- End Procedure Tab -->

        <!-- General Equations Tab -->
        <div id="equations-tab" class="tab-content">
            <div class="section">
                <h2>Bevel Gear Geometry - General Equations</h2>

                <h3>Basic Geometry</h3>
                <div class="equation-block">
                    <div class="equation-latex">$m_G = \frac{N_G}{N_P}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>m<sub>G</sub></label>
                            <input type="number" id="mG_genEq1" step="any" oninput="syncAllInstances('mG_genEq1'); markAsUser('mG_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_genEq1" step="any" oninput="syncAllInstances('NG_genEq1'); markAsUser('NG_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>P</sub></label>
                            <input type="number" id="NP_genEq1" step="any" oninput="syncAllInstances('NP_genEq1'); markAsUser('NP_genEq1'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Ratio</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$D = \frac{N_G}{P_d}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>D (in)</label>
                            <input type="number" id="D_genEq1" step="any" oninput="syncAllInstances('D_genEq1'); markAsUser('D_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_genEq2" step="any" oninput="syncAllInstances('NG_genEq2'); markAsUser('NG_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_genEq1" step="any" oninput="syncAllInstances('Pd_genEq1'); markAsUser('Pd_genEq1'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Pitch Diameter</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$d = \frac{N_P}{P_d}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>d (in)</label>
                            <input type="number" id="d_genEq1" step="any" oninput="syncAllInstances('d_genEq1'); markAsUser('d_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>P</sub></label>
                            <input type="number" id="NP_genEq2" step="any" oninput="syncAllInstances('NP_genEq2'); markAsUser('NP_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_genEq2" step="any" oninput="syncAllInstances('Pd_genEq2'); markAsUser('Pd_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Pinion Pitch Diameter</p>
                </div>

                <h3>Pitch Cone Angles</h3>
                <div class="equation-block">
                    <div class="equation-latex">$\gamma = \tan^{-1}\left(\frac{N_P}{N_G}\right)$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>γ (°)</label>
                            <input type="number" id="gamma_genEq1" step="any" oninput="syncAllInstances('gamma_genEq1'); markAsUser('gamma_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>P</sub></label>
                            <input type="number" id="NP_genEq3" step="any" oninput="syncAllInstances('NP_genEq3'); markAsUser('NP_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_genEq3" step="any" oninput="syncAllInstances('NG_genEq3'); markAsUser('NG_genEq3'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Pinion Pitch Cone Angle</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$\Gamma = \tan^{-1}\left(\frac{N_G}{N_P}\right)$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>Γ (°)</label>
                            <input type="number" id="Gamma_genEq1" step="any" oninput="syncAllInstances('Gamma_genEq1'); markAsUser('Gamma_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_genEq4" step="any" oninput="syncAllInstances('NG_genEq4'); markAsUser('NG_genEq4'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>P</sub></label>
                            <input type="number" id="NP_genEq4" step="any" oninput="syncAllInstances('NP_genEq4'); markAsUser('NP_genEq4'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Pitch Cone Angle</p>
                </div>

                <h3>Distances</h3>
                <div class="equation-block">
                    <div class="equation-latex">$A_O = \frac{0.5 D}{\sin(\Gamma)}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq1" step="any" oninput="syncAllInstances('AO_genEq1'); markAsUser('AO_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>D (in)</label>
                            <input type="number" id="D_genEq2" step="any" oninput="syncAllInstances('D_genEq2'); markAsUser('D_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>Γ (°)</label>
                            <input type="number" id="Gamma_genEq2" step="any" oninput="syncAllInstances('Gamma_genEq2'); markAsUser('Gamma_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Cone Distance</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$F_{nom} = \frac{A_O}{3}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>F<sub>nom</sub> (in)</label>
                            <input type="number" id="Fnom_genEq1" step="any" oninput="syncAllInstances('Fnom_genEq1'); markAsUser('Fnom_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq2" step="any" oninput="syncAllInstances('AO_genEq2'); markAsUser('AO_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Nominal Face Width</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$F_{max} = \frac{10}{P_d}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>F<sub>max</sub> (in)</label>
                            <input type="number" id="Fmax_genEq1" step="any" oninput="syncAllInstances('Fmax_genEq1'); markAsUser('Fmax_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_genEq3" step="any" oninput="syncAllInstances('Pd_genEq3'); markAsUser('Pd_genEq3'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Maximum Face Width</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$A_m = A_O - \frac{F}{2}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>A<sub>m</sub> (in)</label>
                            <input type="number" id="Am_genEq1" step="any" oninput="syncAllInstances('Am_genEq1'); markAsUser('Am_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq3" step="any" oninput="syncAllInstances('AO_genEq3'); markAsUser('AO_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>F (in)</label>
                            <input type="number" id="F_genEq1" step="any" oninput="syncAllInstances('F_genEq1'); markAsUser('F_genEq1'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Mean Cone Distance</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$p_m = \frac{\pi A_m}{0.5 N_G}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>p<sub>m</sub> (in)</label>
                            <input type="number" id="pm_genEq1" step="any" oninput="syncAllInstances('pm_genEq1'); markAsUser('pm_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>m</sub> (in)</label>
                            <input type="number" id="Am_genEq2" step="any" oninput="syncAllInstances('Am_genEq2'); markAsUser('Am_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>N<sub>G</sub></label>
                            <input type="number" id="NG_genEq5" step="any" oninput="syncAllInstances('NG_genEq5'); markAsUser('NG_genEq5'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Mean Circular Pitch</p>
                </div>

                <h3>Depth and Clearance</h3>
                <div class="equation-block">
                    <div class="equation-latex">$h = \frac{2.188}{P_d}$ (coarse) or $h = \frac{2}{P_d} + 0.002$ (fine)</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>h (in)</label>
                            <input type="number" id="h_genEq1" step="any" oninput="syncAllInstances('h_genEq1'); markAsUser('h_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_genEq4" step="any" oninput="syncAllInstances('Pd_genEq4'); markAsUser('Pd_genEq4'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Whole Depth</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$c = \frac{0.188}{P_d}$ (coarse) or $c = 0.002$ (fine)</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>c (in)</label>
                            <input type="number" id="c_genEq1" step="any" oninput="syncAllInstances('c_genEq1'); markAsUser('c_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>P<sub>d</sub></label>
                            <input type="number" id="Pd_genEq5" step="any" oninput="syncAllInstances('Pd_genEq5'); markAsUser('Pd_genEq5'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Clearance</p>
                </div>

                <h3>Mean Dimensions</h3>
                <div class="equation-block">
                    <div class="equation-latex">$h_m = h \cos(\Gamma) - \frac{c}{2}$ (coarse) or $h_m = h \cos(\Gamma) - c$ (fine)</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>h<sub>m</sub> (in)</label>
                            <input type="number" id="hm_genEq1" step="any" oninput="syncAllInstances('hm_genEq1'); markAsUser('hm_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>h (in)</label>
                            <input type="number" id="h_genEq2" step="any" oninput="syncAllInstances('h_genEq2'); markAsUser('h_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>Γ (°)</label>
                            <input type="number" id="Gamma_genEq3" step="any" oninput="syncAllInstances('Gamma_genEq3'); markAsUser('Gamma_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>c (in)</label>
                            <input type="number" id="c_genEq2" step="any" oninput="syncAllInstances('c_genEq2'); markAsUser('c_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Mean Whole Depth</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$c_1 = \frac{c}{2}$ (coarse) or $c_1 = c$ (fine)</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>c<sub>1</sub> (in)</label>
                            <input type="number" id="c1_genEq1" step="any" oninput="syncAllInstances('c1_genEq1'); markAsUser('c1_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>c (in)</label>
                            <input type="number" id="c_genEq3" step="any" oninput="syncAllInstances('c_genEq3'); markAsUser('c_genEq3'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Mean Clearance</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$a_m = \frac{h_m}{2}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>a<sub>m</sub> (in)</label>
                            <input type="number" id="am_genEq1" step="any" oninput="syncAllInstances('am_genEq1'); markAsUser('am_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>h<sub>m</sub> (in)</label>
                            <input type="number" id="hm_genEq2" step="any" oninput="syncAllInstances('hm_genEq2'); markAsUser('hm_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Mean Addendum</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$b_m = h_m - a_m$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>b<sub>m</sub> (in)</label>
                            <input type="number" id="bm_genEq1" step="any" oninput="syncAllInstances('bm_genEq1'); markAsUser('bm_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>h<sub>m</sub> (in)</label>
                            <input type="number" id="hm_genEq3" step="any" oninput="syncAllInstances('hm_genEq3'); markAsUser('hm_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>m</sub> (in)</label>
                            <input type="number" id="am_genEq2" step="any" oninput="syncAllInstances('am_genEq2'); markAsUser('am_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Mean Dedendum</p>
                </div>

                <h3>Addendum and Dedendum Angles</h3>
                <div class="equation-block">
                    <div class="equation-latex">$a_G = \frac{a_m}{A_O}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>a<sub>G</sub> (in)</label>
                            <input type="number" id="aG_genEq1" step="any" oninput="syncAllInstances('aG_genEq1'); markAsUser('aG_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>m</sub> (in)</label>
                            <input type="number" id="am_genEq3" step="any" oninput="syncAllInstances('am_genEq3'); markAsUser('am_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq4" step="any" oninput="syncAllInstances('AO_genEq4'); markAsUser('AO_genEq4'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Addendum Angle</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$a_P = \frac{a_m}{A_O}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>a<sub>P</sub> (in)</label>
                            <input type="number" id="aP_genEq1" step="any" oninput="syncAllInstances('aP_genEq1'); markAsUser('aP_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>m</sub> (in)</label>
                            <input type="number" id="am_genEq4" step="any" oninput="syncAllInstances('am_genEq4'); markAsUser('am_genEq4'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq5" step="any" oninput="syncAllInstances('AO_genEq5'); markAsUser('AO_genEq5'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Pinion Addendum Angle</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$b_G = \frac{b_m}{A_O}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>b<sub>G</sub> (in)</label>
                            <input type="number" id="bG_genEq1" step="any" oninput="syncAllInstances('bG_genEq1'); markAsUser('bG_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>b<sub>m</sub> (in)</label>
                            <input type="number" id="bm_genEq2" step="any" oninput="syncAllInstances('bm_genEq2'); markAsUser('bm_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq6" step="any" oninput="syncAllInstances('AO_genEq6'); markAsUser('AO_genEq6'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Dedendum Angle</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$b_P = \frac{b_m}{A_O}$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>b<sub>P</sub> (in)</label>
                            <input type="number" id="bP_genEq1" step="any" oninput="syncAllInstances('bP_genEq1'); markAsUser('bP_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>b<sub>m</sub> (in)</label>
                            <input type="number" id="bm_genEq3" step="any" oninput="syncAllInstances('bm_genEq3'); markAsUser('bm_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>A<sub>O</sub> (in)</label>
                            <input type="number" id="AO_genEq7" step="any" oninput="syncAllInstances('AO_genEq7'); markAsUser('AO_genEq7'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Pinion Dedendum Angle</p>
                </div>

                <h3>Face Angles</h3>
                <div class="equation-block">
                    <div class="equation-latex">$\delta_G = \Gamma + a_G$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>δ<sub>G</sub> (°)</label>
                            <input type="number" id="deltaG_genEq1" step="any" oninput="syncAllInstances('deltaG_genEq1'); markAsUser('deltaG_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>Γ (°)</label>
                            <input type="number" id="Gamma_genEq4" step="any" oninput="syncAllInstances('Gamma_genEq4'); markAsUser('Gamma_genEq4'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>G</sub></label>
                            <input type="number" id="aG_genEq2" step="any" oninput="syncAllInstances('aG_genEq2'); markAsUser('aG_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Face Angle</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$\delta_P = \gamma + a_P$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>δ<sub>P</sub> (°)</label>
                            <input type="number" id="deltaP_genEq1" step="any" oninput="syncAllInstances('deltaP_genEq1'); markAsUser('deltaP_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>γ (°)</label>
                            <input type="number" id="gamma_genEq2" step="any" oninput="syncAllInstances('gamma_genEq2'); markAsUser('gamma_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>P</sub></label>
                            <input type="number" id="aP_genEq2" step="any" oninput="syncAllInstances('aP_genEq2'); markAsUser('aP_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Pinion Face Angle</p>
                </div>

                <h3>Outer Addendums and Outside Diameters</h3>
                <div class="equation-block">
                    <div class="equation-latex">$a_{OG} = a_m + \frac{F}{2} \sin(\delta_G)$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>a<sub>OG</sub> (in)</label>
                            <input type="number" id="aOG_genEq1" step="any" oninput="syncAllInstances('aOG_genEq1'); markAsUser('aOG_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>m</sub> (in)</label>
                            <input type="number" id="am_genEq5" step="any" oninput="syncAllInstances('am_genEq5'); markAsUser('am_genEq5'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>F (in)</label>
                            <input type="number" id="F_genEq2" step="any" oninput="syncAllInstances('F_genEq2'); markAsUser('F_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>δ<sub>G</sub> (°)</label>
                            <input type="number" id="deltaG_genEq2" step="any" oninput="syncAllInstances('deltaG_genEq2'); markAsUser('deltaG_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Outer Addendum (Gear)</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$a_{OP} = a_m + \frac{F}{2} \sin(\delta_P)$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>a<sub>OP</sub> (in)</label>
                            <input type="number" id="aOP_genEq1" step="any" oninput="syncAllInstances('aOP_genEq1'); markAsUser('aOP_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>m</sub> (in)</label>
                            <input type="number" id="am_genEq6" step="any" oninput="syncAllInstances('am_genEq6'); markAsUser('am_genEq6'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>F (in)</label>
                            <input type="number" id="F_genEq3" step="any" oninput="syncAllInstances('F_genEq3'); markAsUser('F_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>δ<sub>P</sub> (°)</label>
                            <input type="number" id="deltaP_genEq2" step="any" oninput="syncAllInstances('deltaP_genEq2'); markAsUser('deltaP_genEq2'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Outer Addendum (Pinion)</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$D_O = D + 2 a_{OG} \cos(\Gamma)$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>D<sub>O</sub> (in)</label>
                            <input type="number" id="DO_genEq1" step="any" oninput="syncAllInstances('DO_genEq1'); markAsUser('DO_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>D (in)</label>
                            <input type="number" id="D_genEq3" step="any" oninput="syncAllInstances('D_genEq3'); markAsUser('D_genEq3'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>OG</sub> (in)</label>
                            <input type="number" id="aOG_genEq2" step="any" oninput="syncAllInstances('aOG_genEq2'); markAsUser('aOG_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>Γ (°)</label>
                            <input type="number" id="Gamma_genEq5" step="any" oninput="syncAllInstances('Gamma_genEq5'); markAsUser('Gamma_genEq5'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Gear Outside Diameter</p>
                </div>

                <div class="equation-block">
                    <div class="equation-latex">$d_O = d + 2 a_{OP} \cos(\gamma)$</div>
                    <div class="equation-inputs">
                        <div class="var-input">
                            <label>d<sub>O</sub> (in)</label>
                            <input type="number" id="dO_genEq1" step="any" oninput="syncAllInstances('dO_genEq1'); markAsUser('dO_genEq1'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>d (in)</label>
                            <input type="number" id="d_genEq2" step="any" oninput="syncAllInstances('d_genEq2'); markAsUser('d_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>a<sub>OP</sub> (in)</label>
                            <input type="number" id="aOP_genEq2" step="any" oninput="syncAllInstances('aOP_genEq2'); markAsUser('aOP_genEq2'); calculate()">
                        </div>
                        <div class="var-input">
                            <label>γ (°)</label>
                            <input type="number" id="gamma_genEq3" step="any" oninput="syncAllInstances('gamma_genEq3'); markAsUser('gamma_genEq3'); calculate()">
                        </div>
                    </div>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">Pinion Outside Diameter</p>
                </div>
            </div>
        </div>

        <!-- Variables Tab -->
        <div id="variables-tab" class="tab-content">
            <h2>All Variables</h2>
            <table class="variables-table">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Description</th>
                        <th>Value</th>
                        <th>Unit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="var-category"><td colspan="4">Given Parameters</td></tr>
                    <tr>
                        <td>P<sub>d</sub></td>
                        <td>Diametral Pitch</td>
                        <td><input type="number" id="var_Pd" step="0.0001" oninput="syncAllInstances('var_Pd'); markAsUser('var_Pd'); calculate()"></td>
                        <td>teeth/in</td>
                    </tr>
                    <tr>
                        <td>φ</td>
                        <td>Pressure Angle</td>
                        <td><input type="number" id="var_phi" step="0.01" oninput="syncAllInstances('var_phi'); markAsUser('var_phi'); calculate()"></td>
                        <td>deg</td>
                    </tr>
                    <tr>
                        <td>N<sub>P</sub></td>
                        <td>Pinion Teeth</td>
                        <td><input type="number" id="var_NP" step="1" oninput="syncAllInstances('var_NP'); markAsUser('var_NP'); calculate()"></td>
                        <td>teeth</td>
                    </tr>
                    <tr>
                        <td>N<sub>G</sub></td>
                        <td>Gear Teeth</td>
                        <td><input type="number" id="var_NG" step="1" oninput="syncAllInstances('var_NG'); markAsUser('var_NG'); calculate()"></td>
                        <td>teeth</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 1: Basic Geometry</td></tr>
                    <tr>
                        <td>m<sub>G</sub></td>
                        <td>Gear Ratio</td>
                        <td><input type="number" id="var_mG" step="0.0001" oninput="syncAllInstances('var_mG'); markAsUser('var_mG'); calculate()"></td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>D</td>
                        <td>Gear Pitch Diameter</td>
                        <td><input type="number" id="var_D" step="0.0001" oninput="syncAllInstances('var_D'); markAsUser('var_D'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>d</td>
                        <td>Pinion Pitch Diameter</td>
                        <td><input type="number" id="var_d" step="0.0001" oninput="syncAllInstances('var_d'); markAsUser('var_d'); calculate()"></td>
                        <td>in</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 2: Pitch Cone Angles</td></tr>
                    <tr>
                        <td>γ</td>
                        <td>Pinion Pitch Cone Angle</td>
                        <td><input type="number" id="var_gamma" step="0.0001" oninput="syncAllInstances('var_gamma'); markAsUser('var_gamma'); calculate()"></td>
                        <td>deg</td>
                    </tr>
                    <tr>
                        <td>Γ</td>
                        <td>Gear Pitch Cone Angle</td>
                        <td><input type="number" id="var_Gamma" step="0.0001" oninput="syncAllInstances('var_Gamma'); markAsUser('var_Gamma'); calculate()"></td>
                        <td>deg</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 3-5: Distances</td></tr>
                    <tr>
                        <td>A<sub>O</sub></td>
                        <td>Cone Distance</td>
                        <td><input type="number" id="var_AO" step="0.0001" oninput="syncAllInstances('var_AO'); markAsUser('var_AO'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>F<sub>nom</sub></td>
                        <td>Nominal Face Width</td>
                        <td><input type="number" id="var_Fnom" step="0.0001" oninput="syncAllInstances('var_Fnom'); markAsUser('var_Fnom'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>F<sub>max</sub></td>
                        <td>Maximum Face Width</td>
                        <td><input type="number" id="var_Fmax" step="0.0001" oninput="syncAllInstances('var_Fmax'); markAsUser('var_Fmax'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>F</td>
                        <td>Selected Face Width</td>
                        <td><input type="number" id="var_F" step="0.0001" oninput="syncAllInstances('var_F'); markAsUser('var_F'); validateFaceWidth(); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>A<sub>m</sub></td>
                        <td>Mean Cone Distance</td>
                        <td><input type="number" id="var_Am" step="0.0001" oninput="syncAllInstances('var_Am'); markAsUser('var_Am'); calculate()"></td>
                        <td>in</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 6: Mean Circular Pitch</td></tr>
                    <tr>
                        <td>p<sub>m</sub></td>
                        <td>Mean Circular Pitch</td>
                        <td><input type="number" id="var_pm" step="0.0001" oninput="syncAllInstances('var_pm'); markAsUser('var_pm'); calculate()"></td>
                        <td>in</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 7: Depth and Clearance</td></tr>
                    <tr>
                        <td>h</td>
                        <td>Whole Depth</td>
                        <td><input type="number" id="var_h" step="0.0001" oninput="syncAllInstances('var_h'); markAsUser('var_h'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>c</td>
                        <td>Clearance</td>
                        <td><input type="number" id="var_c" step="0.0001" oninput="syncAllInstances('var_c'); markAsUser('var_c'); calculate()"></td>
                        <td>in</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 8: Mean Dimensions</td></tr>
                    <tr>
                        <td>h<sub>m</sub></td>
                        <td>Mean Whole Depth</td>
                        <td><input type="number" id="var_hm" step="0.0001" oninput="syncAllInstances('var_hm'); markAsUser('var_hm'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>c<sub>1</sub></td>
                        <td>Mean Clearance</td>
                        <td><input type="number" id="var_c1" step="0.0001" oninput="syncAllInstances('var_c1'); markAsUser('var_c1'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>a<sub>m</sub></td>
                        <td>Mean Addendum</td>
                        <td><input type="number" id="var_am" step="0.0001" oninput="syncAllInstances('var_am'); markAsUser('var_am'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>b<sub>m</sub></td>
                        <td>Mean Dedendum</td>
                        <td><input type="number" id="var_bm" step="0.0001" oninput="syncAllInstances('var_bm'); markAsUser('var_bm'); calculate()"></td>
                        <td>in</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 9: Angles</td></tr>
                    <tr>
                        <td>a<sub>G</sub></td>
                        <td>Gear Addendum Angle</td>
                        <td><input type="number" id="var_aG" step="0.0001" oninput="syncAllInstances('var_aG'); markAsUser('var_aG'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>a<sub>P</sub></td>
                        <td>Pinion Addendum Angle</td>
                        <td><input type="number" id="var_aP" step="0.0001" oninput="syncAllInstances('var_aP'); markAsUser('var_aP'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>b<sub>G</sub></td>
                        <td>Gear Dedendum Angle</td>
                        <td><input type="number" id="var_bG" step="0.0001" oninput="syncAllInstances('var_bG'); markAsUser('var_bG'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>b<sub>P</sub></td>
                        <td>Pinion Dedendum Angle</td>
                        <td><input type="number" id="var_bP" step="0.0001" oninput="syncAllInstances('var_bP'); markAsUser('var_bP'); calculate()"></td>
                        <td>in</td>
                    </tr>

                    <tr class="var-category"><td colspan="4">Step 10: Final Dimensions</td></tr>
                    <tr>
                        <td>δ<sub>G</sub></td>
                        <td>Gear Face Angle</td>
                        <td><input type="number" id="var_deltaG" step="0.0001" oninput="syncAllInstances('var_deltaG'); markAsUser('var_deltaG'); calculate()"></td>
                        <td>deg</td>
                    </tr>
                    <tr>
                        <td>δ<sub>P</sub></td>
                        <td>Pinion Face Angle</td>
                        <td><input type="number" id="var_deltaP" step="0.0001" oninput="syncAllInstances('var_deltaP'); markAsUser('var_deltaP'); calculate()"></td>
                        <td>deg</td>
                    </tr>
                    <tr>
                        <td>a<sub>OG</sub></td>
                        <td>Gear Outer Addendum</td>
                        <td><input type="number" id="var_aOG" step="0.0001" oninput="syncAllInstances('var_aOG'); markAsUser('var_aOG'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>a<sub>OP</sub></td>
                        <td>Pinion Outer Addendum</td>
                        <td><input type="number" id="var_aOP" step="0.0001" oninput="syncAllInstances('var_aOP'); markAsUser('var_aOP'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>D<sub>O</sub></td>
                        <td>Gear Outside Diameter</td>
                        <td><input type="number" id="var_DO" step="0.0001" oninput="syncAllInstances('var_DO'); markAsUser('var_DO'); calculate()"></td>
                        <td>in</td>
                    </tr>
                    <tr>
                        <td>d<sub>O</sub></td>
                        <td>Pinion Outside Diameter</td>
                        <td><input type="number" id="var_dO" step="0.0001" oninput="syncAllInstances('var_dO'); markAsUser('var_dO'); calculate()"></td>
                        <td>in</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <script>
        // Track which values are user-entered vs computed
        let userValues = new Set(['Pd', 'phi', 'NP', 'NG', 'F']);

        // Mark a field as user-entered
        function markAsUser(fieldId) {
            userValues.add(fieldId);
        }

        // Sync duplicate fields (for the same variable shown in multiple equations)
        function syncInput(mainId, sourceId) {
            const value = document.getElementById(sourceId).value;
            document.getElementById(mainId).value = value;
            // Sync to all instances including Variables tab
            syncAllInstances(sourceId);
            markAsUser(mainId);
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            const activeTab = document.getElementById(tabName + '-tab');
            if (activeTab) {
                activeTab.classList.add('active');
            }

            event.currentTarget.classList.add('active');

            if (typeof MathJax !== 'undefined' && activeTab) {
                MathJax.typesetPromise([activeTab]).catch((err) => console.log(err));
            }
        }

        // Variable Instance Mapping for syncing across tabs
        const varInstanceMap = {
            'Pd': ['Pd', 'var_Pd', 'Pd_eq1', 'Pd_eq2', 'Pd_eq4', 'Pd_eq7', 'Pd_eq7b', 'Pd_genEq1', 'Pd_genEq2', 'Pd_genEq3', 'Pd_genEq4', 'Pd_genEq5'],
            'phi': ['phi', 'var_phi'],
            'NP': ['NP', 'var_NP', 'NP_eq1', 'NP_eq2', 'NP_eq3', 'NP_eq4', 'NP_genEq1', 'NP_genEq2', 'NP_genEq3', 'NP_genEq4'],
            'NG': ['NG', 'var_NG', 'NG_eq1', 'NG_eq2', 'NG_eq3', 'NG_eq4', 'NG_eq6', 'NG_genEq1', 'NG_genEq2', 'NG_genEq3', 'NG_genEq4', 'NG_genEq5'],
            'mG': ['mG', 'var_mG', 'mG_genEq1'],
            'D': ['D', 'var_D', 'D_eq3', 'D_eq10e', 'D_genEq1', 'D_genEq2', 'D_genEq3'],
            'd': ['d', 'var_d', 'd_eq10f', 'd_genEq1', 'd_genEq2'],
            'gamma': ['gamma', 'var_gamma', 'gamma_eq10b', 'gamma_eq10f', 'gamma_genEq1', 'gamma_genEq2', 'gamma_genEq3'],
            'Gamma': ['Gamma', 'var_Gamma', 'Gamma_eq3', 'Gamma_eq8', 'Gamma_eq10a', 'Gamma_eq10e', 'Gamma_genEq1', 'Gamma_genEq2', 'Gamma_genEq3', 'Gamma_genEq4', 'Gamma_genEq5'],
            'AO': ['AO', 'var_AO', 'AO_eq4a', 'AO_eq5', 'AO_eq9a', 'AO_eq9b', 'AO_eq9c', 'AO_eq9d', 'AO_genEq1', 'AO_genEq2', 'AO_genEq3', 'AO_genEq4', 'AO_genEq5', 'AO_genEq6', 'AO_genEq7'],
            'Fnom': ['Fnom', 'var_Fnom', 'Fnom_genEq1'],
            'Fmax': ['Fmax', 'var_Fmax', 'Fmax_genEq1'],
            'F': ['F', 'var_F', 'F_eq5', 'F_eq10c', 'F_eq10d', 'F_genEq1', 'F_genEq2', 'F_genEq3'],
            'Am': ['Am', 'var_Am', 'Am_eq6', 'Am_genEq1', 'Am_genEq2'],
            'pm': ['pm', 'var_pm', 'pm_genEq1'],
            'h': ['h', 'var_h', 'h_eq8', 'h_genEq1', 'h_genEq2'],
            'c': ['c', 'var_c', 'c_eq8', 'c_eq8b', 'c_genEq1', 'c_genEq2', 'c_genEq3'],
            'hm': ['hm', 'var_hm', 'hm_eq8c', 'hm_eq8d', 'hm_genEq1', 'hm_genEq2', 'hm_genEq3'],
            'c1': ['c1', 'var_c1', 'c1_genEq1'],
            'am': ['am', 'var_am', 'am_eq8d', 'am_eq9a', 'am_eq9b', 'am_eq10c', 'am_eq10d', 'am_genEq1', 'am_genEq2', 'am_genEq3', 'am_genEq4', 'am_genEq5', 'am_genEq6'],
            'bm': ['bm', 'var_bm', 'bm_eq9c', 'bm_eq9d', 'bm_genEq1', 'bm_genEq2', 'bm_genEq3'],
            'aG': ['aG', 'var_aG', 'aG_eq10a', 'aG_genEq1', 'aG_genEq2'],
            'aP': ['aP', 'var_aP', 'aP_eq10b', 'aP_genEq1', 'aP_genEq2'],
            'bG': ['bG', 'var_bG', 'bG_genEq1'],
            'bP': ['bP', 'var_bP', 'bP_genEq1'],
            'deltaG': ['deltaG', 'var_deltaG', 'deltaG_eq10c', 'deltaG_genEq1', 'deltaG_genEq2'],
            'deltaP': ['deltaP', 'var_deltaP', 'deltaP_eq10d', 'deltaP_genEq1', 'deltaP_genEq2'],
            'aOG': ['aOG', 'var_aOG', 'aOG_eq10e', 'aOG_genEq1', 'aOG_genEq2'],
            'aOP': ['aOP', 'var_aOP', 'aOP_eq10f', 'aOP_genEq1', 'aOP_genEq2'],
            'DO': ['DO', 'var_DO', 'DO_genEq1'],
            'dO': ['dO', 'var_dO', 'dO_genEq1']
        };

        function getBaseVarName(id) {
            if (id.startsWith('var_')) {
                return id.substring(4);
            }
            const underscoreIndex = id.indexOf('_eq');
            if (underscoreIndex !== -1) {
                return id.substring(0, underscoreIndex);
            }
            return id;
        }

        function syncAllInstances(changedId) {
            const baseVar = getBaseVarName(changedId);
            const instances = varInstanceMap[baseVar];
            if (!instances) return;

            const changedInput = document.getElementById(changedId);
            if (!changedInput) return;

            const newValue = changedInput.value;

            instances.forEach(instanceId => {
                if (instanceId !== changedId) {
                    const input = document.getElementById(instanceId);
                    if (input) {
                        input.value = newValue;
                    }
                }
            });
        }

        // Get value with fallback
        function getValue(id) {
            const val = parseFloat(document.getElementById(id).value);
            return isNaN(val) ? null : val;
        }

        // Set value and mark as computed
        function setValue(id, value) {
            if (value !== null && !userValues.has(id)) {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value.toFixed(4);
                    element.classList.add('computed');
                    // Sync to all instances including Variables tab
                    syncAllInstances(id);
                }
            }
        }

        // Sync all duplicate fields
        function syncAllFields() {
            const mainVars = ['Pd', 'phi', 'NP', 'NG', 'D', 'd', 'gamma', 'Gamma', 'AO',
                              'F', 'Am', 'pm', 'h', 'c', 'hm', 'c1', 'am', 'bm', 'aG', 'aP', 'bG', 'bP',
                              'deltaG', 'deltaP', 'aOG', 'aOP', 'mG', 'Fnom', 'Fmax', 'DO', 'dO'];

            mainVars.forEach(varId => {
                const mainValue = getValue(varId);
                const mainElement = document.getElementById(varId);
                const isComputed = mainElement && mainElement.classList.contains('computed');

                if (mainValue !== null) {
                    document.querySelectorAll(`input[id^="${varId}_eq"]`).forEach(input => {
                        if (getValue(input.id) !== mainValue) {
                            input.value = mainValue.toFixed(4);
                        }
                        // Apply computed class to synced fields if main is computed
                        if (isComputed && !userValues.has(input.id)) {
                            input.classList.add('computed');
                        }
                    });
                }
            });
        }

        function validateFaceWidth() {
            const F = getValue('F');
            const Fnom = getValue('Fnom');
            const Fmax = getValue('Fmax');

            const warning = document.getElementById('F-warning');

            if (F && Fnom && Fmax) {
                if (F < Fnom) {
                    warning.textContent = `⚠️ Warning: F (${F.toFixed(4)}) is below recommended minimum Fnom (${Fnom.toFixed(4)})`;
                    warning.style.display = 'block';
                } else if (F > Fmax) {
                    warning.textContent = `⚠️ Warning: F (${F.toFixed(4)}) exceeds recommended maximum Fmax (${Fmax.toFixed(4)})`;
                    warning.style.display = 'block';
                } else {
                    warning.style.display = 'none';
                }
            } else {
                warning.style.display = 'none';
            }
        }

        function calculate() {
            // Get primary input values
            const Pd = getValue('Pd');
            const phi = getValue('phi');
            const NP = getValue('NP');
            const NG = getValue('NG');

            // Determine pitch type and update formulas
            let isCoarse = Pd < 20;
            const pitchIndicator = document.getElementById('pitch-type-indicator');
            const hLatex = document.getElementById('h-equation-latex');
            const cLatex = document.getElementById('c-equation-latex');
            const hmLatex = document.getElementById('hm-equation-latex');
            const c1Latex = document.getElementById('c1-equation-latex');

            if (Pd && Pd > 0) {
                if (isCoarse) {
                    pitchIndicator.innerHTML = '<div class="pitch-info">Coarse Pitch (P<sub>d</sub> < 20 teeth/in)</div>';
                    hLatex.innerHTML = '$$h = \\frac{2.188}{P_d}$$';
                    cLatex.innerHTML = '$$c = \\frac{0.188}{P_d}$$';
                    hmLatex.innerHTML = '$$h_m = h \\cos(\\Gamma) - \\frac{c}{2}$$';
                    c1Latex.innerHTML = '$$c_1 = \\frac{c}{2}$$';
                    document.getElementById('h-formula-text').textContent = '= 2.188 /';
                    document.getElementById('c-formula-text').textContent = '= 0.188 /';
                    document.getElementById('hm-formula-text').textContent = ') - (';
                    document.getElementById('hm-formula-text2').textContent = '/ 2)';
                    document.getElementById('c1-formula-text').textContent = '=';
                    document.getElementById('c1-formula-text2').textContent = '/ 2';
                } else {
                    pitchIndicator.innerHTML = '<div class="pitch-info">Fine Pitch (P<sub>d</sub> ≥ 20 teeth/in)</div>';
                    hLatex.innerHTML = '$$h = \\frac{2}{P_d} + 0.002$$';
                    cLatex.innerHTML = '$$c = 0.002$$';
                    hmLatex.innerHTML = '$$h_m = h \\cos(\\Gamma) - c$$';
                    c1Latex.innerHTML = '$$c_1 = c$$';
                    document.getElementById('h-formula-text').textContent = '= (2 / Pd) + 0.002';
                    document.getElementById('c-formula-text').textContent = '= 0.002';
                    document.getElementById('hm-formula-text').textContent = ') -';
                    document.getElementById('hm-formula-text2').textContent = '';
                    document.getElementById('c1-formula-text').textContent = '=';
                    document.getElementById('c1-formula-text2').textContent = '';
                }
                MathJax.typesetPromise([hLatex, cLatex, hmLatex, c1Latex]);
            } else {
                pitchIndicator.innerHTML = '';
            }

            // Step 1: Gear Ratio and Pitch Diameters
            if (NG && NP && NG > 0 && NP > 0) {
                setValue('mG', NG / NP);
            }
            if (Pd && Pd > 0 && NG && NG > 0) {
                setValue('D', NG / Pd);
            }
            if (Pd && Pd > 0 && NP && NP > 0) {
                setValue('d', NP / Pd);
            }

            // Step 2: Pitch Cone Angles (convert to degrees)
            if (NP && NG && NP > 0 && NG > 0) {
                const gammaRad = Math.atan(NP / NG);
                setValue('gamma', gammaRad * 180 / Math.PI);

                const GammaRad = Math.atan(NG / NP);
                setValue('Gamma', GammaRad * 180 / Math.PI);
            }

            // Step 3: Cone Distance
            const D = getValue('D');
            const Gamma = getValue('Gamma');
            if (D !== null && Gamma !== null) {
                const GammaRad = Gamma * Math.PI / 180;
                setValue('AO', (0.5 * D) / Math.sin(GammaRad));
            }

            // Step 4: Face Width Range
            const AO = getValue('AO');
            if (AO !== null) {
                setValue('Fnom', AO / 3);
            }
            if (Pd && Pd > 0) {
                setValue('Fmax', 10 / Pd);
            }
            validateFaceWidth();

            // Step 5: Mean Cone Distance
            const F = getValue('F');
            if (AO !== null && F !== null) {
                setValue('Am', AO - F / 2);
            }

            // Step 6: Mean Circular Pitch
            const Am = getValue('Am');
            if (Am !== null && NG && NG > 0) {
                setValue('pm', (Math.PI * Am) / (0.5 * NG));
            }

            // Step 7: Whole Depth and Clearance
            if (Pd && Pd > 0) {
                if (isCoarse) {
                    setValue('h', 2.188 / Pd);
                    setValue('c', 0.188 / Pd);
                } else {
                    setValue('h', 2 / Pd + 0.002);
                    setValue('c', 0.002);
                }
            }

            // Step 8: Mean Addendum and Dedendum
            const h = getValue('h');
            const c = getValue('c');
            if (h !== null && Gamma !== null && c !== null) {
                const GammaRad = Gamma * Math.PI / 180;
                if (isCoarse) {
                    setValue('hm', h * Math.cos(GammaRad) - c / 2);
                    setValue('c1', c / 2);
                } else {
                    setValue('hm', h * Math.cos(GammaRad) - c);
                    setValue('c1', c);
                }
            }

            const hm = getValue('hm');
            if (hm !== null) {
                setValue('am', hm / 2);
            }

            const am = getValue('am');
            if (hm !== null && am !== null) {
                setValue('bm', hm - am);
            }

            // Step 9: Addendum and Dedendum Angles
            const bm = getValue('bm');
            if (am !== null && AO !== null) {
                setValue('aG', am / AO);
                setValue('aP', am / AO);
            }
            if (bm !== null && AO !== null) {
                setValue('bG', bm / AO);
                setValue('bP', bm / AO);
            }

            // Step 10: Face Angles and Outside Diameters
            const gamma = getValue('gamma');
            const aG = getValue('aG');
            const aP = getValue('aP');

            if (Gamma !== null && aG !== null) {
                setValue('deltaG', Gamma + aG);
            }
            if (gamma !== null && aP !== null) {
                setValue('deltaP', gamma + aP);
            }

            const deltaG = getValue('deltaG');
            const deltaP = getValue('deltaP');

            if (am !== null && F !== null && deltaG !== null) {
                const deltaGRad = deltaG * Math.PI / 180;
                setValue('aOG', am + (F / 2) * Math.sin(deltaGRad));
            }
            if (am !== null && F !== null && deltaP !== null) {
                const deltaPRad = deltaP * Math.PI / 180;
                setValue('aOP', am + (F / 2) * Math.sin(deltaPRad));
            }

            const aOG = getValue('aOG');
            const aOP = getValue('aOP');
            const d = getValue('d');

            if (D !== null && aOG !== null && Gamma !== null) {
                const GammaRad = Gamma * Math.PI / 180;
                setValue('DO', D + 2 * aOG * Math.cos(GammaRad));
            }
            if (d !== null && aOP !== null && gamma !== null) {
                const gammaRad = gamma * Math.PI / 180;
                setValue('dO', d + 2 * aOP * Math.cos(gammaRad));
            }

            // Sync duplicate fields
            syncAllFields();
        }

        function saveSession() {
            const data = {};
            document.querySelectorAll('input[type="number"]').forEach(input => {
                if (input.value) {
                    data[input.id] = input.value;
                }
            });
            data._userValues = Array.from(userValues);
            localStorage.setItem('bevelGearSession', JSON.stringify(data));
            alert('Session saved!');
        }

        function loadSession() {
            const saved = localStorage.getItem('bevelGearSession');
            if (saved) {
                const data = JSON.parse(saved);
                for (let key in data) {
                    if (key === '_userValues') {
                        userValues = new Set(data[key]);
                    } else {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = data[key];
                        }
                    }
                }
            }
        }

        function resetAll() {
            if (confirm('Reset all values?')) {
                document.querySelectorAll('input').forEach(input => {
                    input.value = '';
                    input.classList.remove('computed');
                });
                userValues = new Set(['Pd', 'phi', 'NP', 'NG', 'F']);
                localStorage.removeItem('bevelGearSession');
                calculate();
            }
        }

        // PDF Crosshairs Feature
        let crosshairsActive = false;
        let crosshairsFeatureEnabled = false;

        function initCrosshairs() {
            const pdfContainer = document.querySelector('.pdf-container');
            const clickOverlay = document.getElementById('click-overlay');
            const svg = document.getElementById('pdf-crosshairs');
            const verticalLine = document.getElementById('crosshair-vertical');
            const horizontalLine = document.getElementById('crosshair-horizontal');

            if (!pdfContainer || !clickOverlay || !svg || !verticalLine || !horizontalLine) return;

            // Start with overlay hidden (PDF fully interactive by default)
            clickOverlay.style.display = 'none';

            // Listen for clicks on the click overlay - toggle crosshairs on/off
            clickOverlay.addEventListener('click', function(e) {
                if (!crosshairsActive) {
                    // SHOW CROSSHAIRS
                    const rect = pdfContainer.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    verticalLine.setAttribute('x1', x);
                    verticalLine.setAttribute('x2', x);
                    verticalLine.setAttribute('y2', rect.height);

                    horizontalLine.setAttribute('y1', y);
                    horizontalLine.setAttribute('y2', y);
                    horizontalLine.setAttribute('x2', rect.width);

                    verticalLine.classList.add('active');
                    horizontalLine.classList.add('active');
                    crosshairsActive = true;
                } else {
                    // HIDE CROSSHAIRS
                    verticalLine.classList.remove('active');
                    horizontalLine.classList.remove('active');
                    crosshairsActive = false;
                }
            });
        }

        function toggleCrosshairsFeature() {
            const clickOverlay = document.getElementById('click-overlay');
            const toggleBtn = document.getElementById('toggle-crosshairs-btn');
            const verticalLine = document.getElementById('crosshair-vertical');
            const horizontalLine = document.getElementById('crosshair-horizontal');

            if (!clickOverlay || !toggleBtn) return;

            crosshairsFeatureEnabled = !crosshairsFeatureEnabled;

            if (crosshairsFeatureEnabled) {
                // ENABLE CROSSHAIRS FEATURE
                clickOverlay.style.display = 'block';
                toggleBtn.textContent = '🎯 Disable Crosshairs';
                toggleBtn.classList.add('active');
            } else {
                // DISABLE CROSSHAIRS FEATURE
                clickOverlay.style.display = 'none';
                toggleBtn.textContent = '🎯 Enable Crosshairs';
                toggleBtn.classList.remove('active');

                // Also hide any active crosshairs
                if (crosshairsActive) {
                    verticalLine.classList.remove('active');
                    horizontalLine.classList.remove('active');
                    crosshairsActive = false;
                }
            }
        }

        // PDF Page Navigation
        function goToPage(page) {
            const embed = document.getElementById("pdf");
            const currSrc = embed.src.split('#')[0];

            // Force complete reload by clearing and resetting with delay
            embed.src = '';
            setTimeout(() => {
                embed.src = `${currSrc}#page=${page}`;
            }, 50);
        }

        // Load on startup
        window.addEventListener('load', function() {
            initCrosshairs();
            loadSession();
            calculate();
        });
    </script>
</body>
</html>
